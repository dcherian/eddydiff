
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BoB ASIRI 2013 CTD χpod &#8212; Eddy Diffusivity</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="P06 CTD χpod analysis" href="P06.html" />
    <link rel="prev" title="EQUIX" href="equix.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Eddy Diffusivity</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Moored χpod analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="tao.html">
   TAO (0, 140) χpod
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="equix.html">
   EQUIX
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  CTD χpod analysis
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   BoB ASIRI 2013 CTD χpod
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="P06.html">
   P06 CTD χpod analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sections-variance-estimate.html">
   Eddy variance generation along GO-SHIP lines
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Variance budgets
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="natre.html">
   NATRE region variance budget
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NATRE analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="natre-examine.html">
   NATRE microstructure dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="natre-finescale.html">
   NATRE micro vs finescale
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Finestructure analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="iw-fine-argo.html">
   Argo finescale estimates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="iw-fine-estimates.html">
   Existing finestructure estimates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="iw-fine-devel.html">
   Finescale Mixing Parametrizations: Development
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ancillary analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="compare-Ke-estimates.html">
   Compare different
   <span class="math notranslate nohighlight">
    \(K_e\)
   </span>
   estimates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="equix-vs-tao.html">
   χpods: EQUIX vs TAO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eqpac-ts-diagrams.html">
   T-S diagrams from TAO &amp; Argo at (0, 145W→135W)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dataset-processing.html">
   Dataset processing
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/BoB-ctd-chipod.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/dcherian/eddydiff"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/dcherian/eddydiff/master?urlpath=tree/notebooks/BoB-ctd-chipod.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transect-ts-plots">
   Transect TS plots
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-and-plot-single-transect">
   Read and plot single transect
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#process-transect-data">
   Process transect data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-in-other-datasets">
   Read in other datasets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-climatological-gradients">
   Using climatological gradients
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#naveira-garabato-et-al-2016-approach">
   Naveira Garabato et al. (2016) approach
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculation">
     Calculation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#debugging-plots">
     Debugging plots
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distributions-dt-dz-and-dt-diapycnal">
     Distributions: dT/dz and dT_diapycnal
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ferrari-polzin-2005-approach">
   Ferrari &amp; Polzin (2005) approach
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#without-interpolating-to-convert-to-density-space">
   Without interpolating to convert to density space
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-various-mean-fields-gradients">
   Compare various mean fields / gradients
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#argo-estimate-cole-et-al-2015">
   Argo estimate (Cole et al, 2015)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#all-data-combined">
   All data combined
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lessons-learned">
   Lessons learned
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#don-t-interpolate-when-converting-to-density-space">
     Don’t interpolate when converting to density space
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spline-smooth-both-temperature-and-pressure">
     Spline-smooth both temperature and pressure
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#groupby-on-dataframe-or-xarray-consistently">
     Groupby on dataframe or xarray consistently
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-gradients-in-isopycnal-planes">
     Test gradients in isopycnal planes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-transect-mat-to-netcdf-files">
     Convert transect .mat to netcdf files
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="bob-asiri-2013-ctd-pod">
<h1>BoB ASIRI 2013 CTD χpod<a class="headerlink" href="#bob-asiri-2013-ctd-pod" title="Permalink to this headline">¶</a></h1>
<p>This notebook will attempt to infer eddy diffusivity <span class="math notranslate nohighlight">\(K_e\)</span> from the basin-wide transect of <span class="math notranslate nohighlight">\(χ, K_T\)</span></p>
<div class="amsmath math notranslate nohighlight" id="equation-22332bea-de8e-4530-a783-effcd4a488dd">
<span class="eqno">(1)<a class="headerlink" href="#equation-22332bea-de8e-4530-a783-effcd4a488dd" title="Permalink to this equation">¶</a></span>\[\begin{equation}
    K_e = \frac{⟨\widetilde{χ}⟩/2 - ⟨K_T \, ∂_z \widetilde{θ}⟩ \; ∂_z θ_m}{|∇θ_m|²}
\end{equation}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../eddydiff/&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">eddydiff</span> <span class="k">as</span> <span class="nn">ed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility. Expected 96, got 88
  return f(*args, **kwds)
</pre></div>
</div>
</div>
</div>
<div class="section" id="transect-ts-plots">
<h2>Transect TS plots<a class="headerlink" href="#transect-ts-plots" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tr1</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/bob-ctd-chipod/transect_1.nc&#39;</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tr2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/bob-ctd-chipod/transect_2.nc&#39;</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tr3</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/bob-ctd-chipod/transect_3.nc&#39;</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
       
<span class="n">_</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">tr1</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">8</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dcpy</span><span class="o">.</span><span class="n">oceans</span><span class="o">.</span><span class="n">TSplot</span><span class="p">(</span><span class="n">tr1</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">tr1</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">tr1</span><span class="o">.</span><span class="n">pres</span><span class="p">,</span> <span class="n">rho_levels</span><span class="o">=</span><span class="n">bins</span><span class="o">-</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transect 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../images/bob-TS-transect-1.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">dcpy</span><span class="o">.</span><span class="n">oceans</span><span class="o">.</span><span class="n">TSplot</span><span class="p">(</span><span class="n">tr2</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">tr2</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">tr2</span><span class="o">.</span><span class="n">pres</span><span class="p">,</span> <span class="n">rho_levels</span><span class="o">=</span><span class="n">bins</span><span class="o">-</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transect 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../images/bob-TS-transect-2.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">dcpy</span><span class="o">.</span><span class="n">oceans</span><span class="o">.</span><span class="n">TSplot</span><span class="p">(</span><span class="n">tr3</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">tr3</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">tr3</span><span class="o">.</span><span class="n">pres</span><span class="p">,</span> <span class="n">rho_levels</span><span class="o">=</span><span class="n">bins</span><span class="o">-</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transect 3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../images/bob-TS-transect-3.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/BoB-ctd-chipod_3_0.png" src="_images/BoB-ctd-chipod_3_0.png" />
<img alt="_images/BoB-ctd-chipod_3_1.png" src="_images/BoB-ctd-chipod_3_1.png" />
<img alt="_images/BoB-ctd-chipod_3_2.png" src="_images/BoB-ctd-chipod_3_2.png" />
</div>
</div>
</div>
<div class="section" id="read-and-plot-single-transect">
<h2>Read and plot single transect<a class="headerlink" href="#read-and-plot-single-transect" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transect</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/bob-ctd-chipod/transect_1.nc&#39;</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">36</span><span class="p">)))</span>

<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1025</span> <span class="o">*</span> <span class="mi">4200</span> <span class="o">*</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span>

<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">36</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
    <span class="n">levels</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">36</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
    <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;black=T, red=ρ&#39;</span><span class="p">)</span>

<span class="c1"># transect = transect.drop(30, dim=&#39;cast&#39;).sel(P=slice(None, 110))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:7: RuntimeWarning: invalid value encountered in greater
  import sys
/home/deepak/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:8: RuntimeWarning: invalid value encountered in greater
  
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5,1,&#39;black=T, red=ρ&#39;)
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_5_2.png" src="_images/BoB-ctd-chipod_5_2.png" />
<img alt="_images/BoB-ctd-chipod_5_3.png" src="_images/BoB-ctd-chipod_5_3.png" />
<img alt="_images/BoB-ctd-chipod_5_4.png" src="_images/BoB-ctd-chipod_5_4.png" />
<img alt="_images/BoB-ctd-chipod_5_5.png" src="_images/BoB-ctd-chipod_5_5.png" />
</div>
</div>
<p>Make sure <span class="math notranslate nohighlight">\(J_q\)</span> isn’t crazy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([ 30., 179., 503., 586., 491., 301., 138.,  67.,  36.,  25.]),
 array([-3.48594309, -2.87431314, -2.2626832 , -1.65105325, -1.03942331,
        -0.42779336,  0.18383659,  0.79546653,  1.40709648,  2.01872642,
         2.63035637]),
 &lt;a list of 10 Patch objects&gt;)
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_7_1.png" src="_images/BoB-ctd-chipod_7_1.png" />
</div>
</div>
</div>
<div class="section" id="process-transect-data">
<h2>Process transect data<a class="headerlink" href="#process-transect-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transect</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/bob-ctd-chipod/transect_1.nc&#39;</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">36</span><span class="p">)))</span>

<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1025</span> <span class="o">*</span> <span class="mi">4200</span> <span class="o">*</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">transect</span> <span class="o">=</span> <span class="n">transect</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">210</span><span class="p">))</span>

<span class="c1"># def process_transect</span>
<span class="c1"># takes transect in z-space as input.</span>

<span class="n">trmean_rho</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">transect_to_density_space</span><span class="p">(</span><span class="n">transect</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in greater
  
/home/deepak/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:7: RuntimeWarning: invalid value encountered in greater
  import sys
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-in-other-datasets">
<h2>Read in other datasets<a class="headerlink" href="#read-in-other-datasets" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cole</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">read_cole</span><span class="p">()</span>

<span class="n">argograd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/argo_dec_iso_gradients.nc&#39;</span><span class="p">,</span>
                           <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="n">eccograd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/ecco_monthly_iso_gradient.nc&#39;</span><span class="p">,</span>
                           <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-climatological-gradients">
<h2>Using climatological gradients<a class="headerlink" href="#using-climatological-gradients" title="Permalink to this headline">¶</a></h2>
<div class="amsmath math notranslate nohighlight" id="equation-b892cb69-7a5a-4b70-a1fa-d3c289f96878">
<span class="eqno">(2)<a class="headerlink" href="#equation-b892cb69-7a5a-4b70-a1fa-d3c289f96878" title="Permalink to this equation">¶</a></span>\[\begin{equation}
    K_e = \frac{⟨\widetilde{χ}⟩/2 - ⟨K_T \, ∂_z \widetilde{θ}⟩ \; ∂_z θ_m}{|∇θ_m|²}
\end{equation}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eccoKe</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">process_transect_1d</span><span class="p">(</span><span class="n">transect</span><span class="p">,</span> <span class="n">eccograd</span><span class="p">,</span> <span class="s1">&#39;ECCO transect1&#39;</span><span class="p">)</span>
<span class="n">argoKe</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">process_transect_1d</span><span class="p">(</span><span class="n">transect</span><span class="p">,</span> <span class="n">argograd</span><span class="p">,</span> <span class="s1">&#39;ARGO transect1&#39;</span><span class="p">)</span>

<span class="n">Ke</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">Ke</span><span class="p">[</span><span class="s1">&#39;ecco&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eccoKe</span><span class="o">.</span><span class="n">Ke</span>
<span class="n">Ke</span><span class="p">[</span><span class="s1">&#39;argo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">argoKe</span><span class="o">.</span><span class="n">Ke</span>
<span class="c1"># Ke[&#39;rho&#39;] = Ke.ecco.index.mid.astype(&#39;float&#39;)</span>
<span class="n">eccoKe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi</th>
      <th>KtTz</th>
      <th>dTdz</th>
      <th>dTmdz</th>
      <th>dTiso</th>
      <th>KT</th>
      <th>Ke</th>
    </tr>
    <tr>
      <th>rho</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(1019.0, 1020.5]</th>
      <td>1.087531e-07</td>
      <td>3.332968e-06</td>
      <td>0.017668</td>
      <td>-0.019127</td>
      <td>2.065550e-06</td>
      <td>0.000894</td>
      <td>-2196.788029</td>
    </tr>
    <tr>
      <th>(1020.5, 1021.0]</th>
      <td>4.242331e-08</td>
      <td>1.787747e-06</td>
      <td>0.023994</td>
      <td>-0.015216</td>
      <td>3.913078e-06</td>
      <td>0.003574</td>
      <td>-391.230758</td>
    </tr>
    <tr>
      <th>(1021.0, 1022.4]</th>
      <td>1.383193e-07</td>
      <td>7.649035e-07</td>
      <td>0.099101</td>
      <td>0.010196</td>
      <td>1.521268e-06</td>
      <td>0.000010</td>
      <td>26514.376375</td>
    </tr>
    <tr>
      <th>(1022.4, 1023.5]</th>
      <td>7.467831e-08</td>
      <td>3.012975e-07</td>
      <td>0.131284</td>
      <td>0.106301</td>
      <td>1.086169e-06</td>
      <td>0.000003</td>
      <td>4501.655168</td>
    </tr>
    <tr>
      <th>(1023.5, 1024.2]</th>
      <td>1.822328e-07</td>
      <td>7.604694e-07</td>
      <td>0.121188</td>
      <td>0.130226</td>
      <td>7.190793e-07</td>
      <td>0.000006</td>
      <td>-15309.981990</td>
    </tr>
    <tr>
      <th>(1024.2, 1024.9]</th>
      <td>2.110117e-07</td>
      <td>1.077232e-06</td>
      <td>0.107393</td>
      <td>0.113445</td>
      <td>4.345696e-07</td>
      <td>0.000011</td>
      <td>-88435.950761</td>
    </tr>
    <tr>
      <th>(1024.9, 1025.4]</th>
      <td>1.015220e-07</td>
      <td>5.481218e-07</td>
      <td>0.093691</td>
      <td>0.091905</td>
      <td>2.953978e-07</td>
      <td>0.000006</td>
      <td>4423.677911</td>
    </tr>
    <tr>
      <th>(1025.4, 1025.8]</th>
      <td>1.114811e-07</td>
      <td>6.400163e-07</td>
      <td>0.079396</td>
      <td>0.082158</td>
      <td>2.854238e-07</td>
      <td>0.000007</td>
      <td>38766.088873</td>
    </tr>
    <tr>
      <th>(1025.8, 1026.1]</th>
      <td>1.349486e-07</td>
      <td>8.839158e-07</td>
      <td>0.060302</td>
      <td>0.077620</td>
      <td>2.923084e-07</td>
      <td>0.000105</td>
      <td>-13281.205312</td>
    </tr>
    <tr>
      <th>(1026.1, 1026.5]</th>
      <td>2.656529e-08</td>
      <td>4.195098e-07</td>
      <td>0.041820</td>
      <td>0.076793</td>
      <td>2.593703e-07</td>
      <td>0.000235</td>
      <td>-281430.091207</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/_pytest/fixtures.py:847: DeprecationWarning: The `convert` argument is deprecated in favor of `converter`.  It will be removed after 2019/01.
  params = attr.ib(convert=attr.converters.optional(tuple))
/home/deepak/anaconda3/lib/python3.6/site-packages/_pytest/fixtures.py:849: DeprecationWarning: The `convert` argument is deprecated in favor of `converter`.  It will be removed after 2019/01.
  ids = attr.ib(default=None, convert=_ensure_immutable_ids)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">plot_bar_Ke</span><span class="p">(</span><span class="n">eccoKe</span><span class="p">)</span>
<span class="c1"># ed.plot_bar_Ke(argoKe)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/BoB-ctd-chipod_15_0.png" src="_images/BoB-ctd-chipod_15_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">argomean</span><span class="o">.</span><span class="n">dTdia</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="n">eccomean</span><span class="o">.</span><span class="n">dTdia</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">trmean</span><span class="o">.</span><span class="n">dTdz</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;argo&#39;</span><span class="p">,</span> <span class="s1">&#39;ecco&#39;</span><span class="p">,</span> <span class="s1">&#39;transect&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">argomean</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="n">eccomean</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-30-9f1417f79a7b&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">argomean</span><span class="o">.</span><span class="n">dTdia</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">eccomean</span><span class="o">.</span><span class="n">dTdia</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="p">(</span><span class="n">trmean</span><span class="o">.</span><span class="n">dTdz</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;argo&#39;</span><span class="p">,</span> <span class="s1">&#39;ecco&#39;</span><span class="p">,</span> <span class="s1">&#39;transect&#39;</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;argomean&#39; is not defined
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 780x660 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ecco</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
 <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">transect</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="p">(</span><span class="n">ecco</span><span class="o">.</span><span class="n">Tmean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
 <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">transect</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-12-04509405bfa7&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="p">(</span><span class="n">ecco</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>  <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">transect</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>  <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">(</span><span class="n">ecco</span><span class="o">.</span><span class="n">Tmean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>

<span class="ne">NameError</span>: name &#39;ecco&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="naveira-garabato-et-al-2016-approach">
<h2>Naveira Garabato et al. (2016) approach<a class="headerlink" href="#naveira-garabato-et-al-2016-approach" title="Permalink to this headline">¶</a></h2>
<p>For turbulence quantities, the averaging operator ⟨⟩ operates <em>only</em> in the vertical direction.</p>
<p>Mean temperature field is determined by spline smoothing on isopycnals and then differentiated to get “large-scale” gradients.</p>
<div class="section" id="calculation">
<h3>Calculation<a class="headerlink" href="#calculation" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. convert to density space</span>
<span class="c1">#############################</span>
<span class="n">trdens</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="n">transect1</span><span class="p">)</span>
<span class="n">Tdens</span> <span class="o">=</span> <span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>

<span class="c1"># 2. fit cubic spline along isopycnal</span>
<span class="c1"># - this needs to take ρbins as input?</span>
<span class="c1">#####################################</span>
<span class="n">Tdens_i</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">smooth_cubic_spline</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">Pdens_i</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">smooth_cubic_spline</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">Tsmooth</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">Tdens_i</span><span class="p">,</span> <span class="n">Pold</span><span class="o">=</span><span class="n">Pdens_i</span><span class="p">,</span> <span class="n">Pnew</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># 3. calculate gradients with smoothed field</span>
<span class="c1">############################################</span>
<span class="n">dTiso</span><span class="p">,</span> <span class="n">dTdia</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">calc_iso_dia_gradients</span><span class="p">(</span><span class="n">Tdens_i</span><span class="p">,</span> <span class="n">Pdens_i</span><span class="p">)</span>
<span class="n">dTmdz</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="o">-</span><span class="n">ed</span><span class="o">.</span><span class="n">xgradient</span><span class="p">(</span><span class="n">Tsmooth</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">))</span>
<span class="n">dTmdz</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dz&#39;</span>

<span class="c1"># 4. Bin smoothed gradients by density</span>
<span class="c1">######################################</span>
<span class="n">ρbins</span> <span class="o">=</span> <span class="n">Tdens_i</span><span class="o">.</span><span class="n">rho</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
<span class="n">dTdf</span> <span class="o">=</span> <span class="p">(</span><span class="n">ed</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">dTdia</span><span class="p">,</span> <span class="n">dTiso</span><span class="p">]),</span>
                    <span class="p">{</span><span class="s1">&#39;cast&#39;</span><span class="p">:</span> <span class="s1">&#39;dist&#39;</span><span class="p">})</span>
        <span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
<span class="n">dTmean</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">bin_avg_in_density</span><span class="p">(</span><span class="n">dTdf</span><span class="p">,</span> <span class="n">ρbins</span><span class="p">)</span>
<span class="n">transmean</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">bin_avg_in_density</span><span class="p">(</span><span class="n">trdens</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">ρbins</span><span class="p">)</span>

<span class="c1"># 5. do estimate</span>
<span class="c1">################</span>
<span class="n">transKe</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;Ke&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">transmean</span><span class="o">.</span><span class="n">chi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">transmean</span><span class="o">.</span><span class="n">KtTz</span> <span class="o">*</span> <span class="n">dTmean</span><span class="o">.</span><span class="n">dia</span><span class="p">)</span><span class="o">/</span><span class="n">dTmean</span><span class="o">.</span><span class="n">iso</span><span class="o">**</span><span class="mi">2</span>
<span class="n">transKe</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;$K_e$&#39;</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transmean</span><span class="o">.</span><span class="n">KT</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transmean</span><span class="o">.</span><span class="n">KtTz</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transmean</span><span class="o">.</span><span class="n">dTdz</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transmean</span><span class="o">.</span><span class="n">chi</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;dTmdz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dTmean</span><span class="o">.</span><span class="n">dia</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;dTiso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dTmean</span><span class="o">.</span><span class="n">iso</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">transKe</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">transKe</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;BoB CTD χpod&#39;</span>

<span class="n">ed</span><span class="o">.</span><span class="n">plot_transect_Ke</span><span class="p">(</span><span class="n">transKe</span><span class="p">)</span>

<span class="n">ed</span><span class="o">.</span><span class="n">plot_bar_Ke</span><span class="p">(</span><span class="n">transKe</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/numpy/lib/function_base.py:1775: RuntimeWarning: divide by zero encountered in true_divide
  a = -(dx2)/(dx1 * (dx1 + dx2))
/home/deepak/anaconda3/lib/python3.6/site-packages/numpy/lib/function_base.py:1775: RuntimeWarning: invalid value encountered in true_divide
  a = -(dx2)/(dx1 * (dx1 + dx2))
/home/deepak/anaconda3/lib/python3.6/site-packages/numpy/lib/function_base.py:1776: RuntimeWarning: divide by zero encountered in true_divide
  b = (dx2 - dx1) / (dx1 * dx2)
/home/deepak/anaconda3/lib/python3.6/site-packages/numpy/lib/function_base.py:1776: RuntimeWarning: invalid value encountered in true_divide
  b = (dx2 - dx1) / (dx1 * dx2)
/home/deepak/anaconda3/lib/python3.6/site-packages/numpy/lib/function_base.py:1777: RuntimeWarning: divide by zero encountered in true_divide
  c = dx1 / (dx2 * (dx1 + dx2))
/home/deepak/anaconda3/lib/python3.6/site-packages/numpy/lib/function_base.py:1777: RuntimeWarning: invalid value encountered in true_divide
  c = dx1 / (dx2 * (dx1 + dx2))
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">InvalidIndexError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-470-da88d5c9529c&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1"># 3. calculate gradients with smoothed field</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1">############################################</span>
<span class="ne">---&gt; </span><span class="mi">15</span> <span class="n">dTiso</span><span class="p">,</span> <span class="n">dTdia</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">calc_iso_dia_gradients</span><span class="p">(</span><span class="n">Tdens_i</span><span class="p">,</span> <span class="n">Pdens_i</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">dTmdz</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="o">-</span><span class="n">ed</span><span class="o">.</span><span class="n">xgradient</span><span class="p">(</span><span class="n">Tsmooth</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="n">dTmdz</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dz&#39;</span>

<span class="nn">~/work/eddydiff/eddydiff/eddydiff.py</span> in <span class="ni">calc_iso_dia_gradients</span><span class="nt">(field, pres, debug)</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span> 
<span class="g g-Whitespace">    </span><span class="mi">387</span>     <span class="n">iso</span> <span class="o">=</span> <span class="p">(</span><span class="n">xgradient</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">388</span>            <span class="o">.</span><span class="n">interp</span><span class="p">({</span><span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">values</span><span class="p">})</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>     <span class="n">iso</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;iso&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span> 

<span class="nn">~/work/python/xarray/xarray/core/dataarray.py</span> in <span class="ni">interp</span><span class="nt">(self, coords, method, assume_sorted, kwargs, **coords_kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">949</span>         <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_temp_dataset</span><span class="p">()</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">950</span>             <span class="n">coords</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">assume_sorted</span><span class="o">=</span><span class="n">assume_sorted</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">951</span>             <span class="o">**</span><span class="n">coords_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">952</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_temp_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">953</span> 

<span class="nn">~/work/python/xarray/xarray/core/dataset.py</span> in <span class="ni">interp</span><span class="nt">(self, coords, method, assume_sorted, kwargs, **coords_kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1876</span>                                     <span class="ow">in</span> <span class="n">indexers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
<span class="g g-Whitespace">   </span><span class="mi">1877</span>                     <span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1878</span>                         <span class="n">var</span><span class="p">,</span> <span class="n">var_indexers</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1879</span>                 <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indexers</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">dims</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1880</span>                     <span class="c1"># keep unrelated object array</span>

<span class="nn">~/work/python/xarray/xarray/core/missing.py</span> in <span class="ni">interp</span><span class="nt">(var, indexes_coords, method, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">427</span>     <span class="c1"># simple speed up for the local interpolation</span>
<span class="g g-Whitespace">    </span><span class="mi">428</span>     <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">]:</span>
<span class="ne">--&gt; </span><span class="mi">429</span>         <span class="n">var</span><span class="p">,</span> <span class="n">indexes_coords</span> <span class="o">=</span> <span class="n">_localize</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">indexes_coords</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">430</span> 
<span class="g g-Whitespace">    </span><span class="mi">431</span>     <span class="c1"># default behavior</span>

<span class="nn">~/work/python/xarray/xarray/core/missing.py</span> in <span class="ni">_localize</span><span class="nt">(var, indexes_coords)</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span>     <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">new_x</span><span class="p">]</span> <span class="ow">in</span> <span class="n">indexes_coords</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>         <span class="n">index</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to_index</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">390</span>         <span class="n">imin</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">new_x</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span>         <span class="n">imax</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">new_x</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">392</span> 

<span class="nn">~/anaconda3/lib/python3.6/site-packages/pandas/core/indexes/numeric.py</span> in <span class="ni">get_loc</span><span class="nt">(self, key, method, tolerance)</span>
<span class="g g-Whitespace">    </span><span class="mi">417</span>             <span class="k">pass</span>
<span class="g g-Whitespace">    </span><span class="mi">418</span>         <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Float64Index</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">419</span>                                                  <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">420</span> 
<span class="g g-Whitespace">    </span><span class="mi">421</span>     <span class="nd">@cache_readonly</span>

<span class="nn">~/anaconda3/lib/python3.6/site-packages/pandas/core/indexes/base.py</span> in <span class="ni">get_loc</span><span class="nt">(self, key, method, tolerance)</span>
<span class="g g-Whitespace">   </span><span class="mi">3066</span>                 <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maybe_cast_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">3067</span> 
<span class="ne">-&gt; </span><span class="mi">3068</span>         <span class="n">indexer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">key</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3069</span>         <span class="k">if</span> <span class="n">indexer</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">indexer</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3070</span>             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;get_loc requires scalar valued input&#39;</span><span class="p">)</span>

<span class="nn">~/anaconda3/lib/python3.6/site-packages/pandas/core/indexes/base.py</span> in <span class="ni">get_indexer</span><span class="nt">(self, target, method, limit, tolerance)</span>
<span class="g g-Whitespace">   </span><span class="mi">3228</span> 
<span class="g g-Whitespace">   </span><span class="mi">3229</span>         <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">3230</span>             <span class="k">raise</span> <span class="n">InvalidIndexError</span><span class="p">(</span><span class="s1">&#39;Reindexing only valid with uniquely&#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">3231</span>                                     <span class="s1">&#39; valued Index objects&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3232</span> 

<span class="ne">InvalidIndexError</span>: Reindexing only valid with uniquely valued Index objects
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="debugging-plots">
<h3>Debugging plots<a class="headerlink" href="#debugging-plots" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trdens</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="n">transect1</span><span class="p">)</span>
<span class="n">Tdens</span> <span class="o">=</span> <span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">dcpy</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">xfilter</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">flen</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
    <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">Pdens_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.contour.QuadContourSet at 0x7f917a6fb048&gt;
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_22_1.png" src="_images/BoB-ctd-chipod_22_1.png" />
</div>
</div>
</div>
<div class="section" id="distributions-dt-dz-and-dt-diapycnal">
<h3>Distributions: dT/dz and dT_diapycnal<a class="headerlink" href="#distributions-dt-dz-and-dt-diapycnal" title="Permalink to this headline">¶</a></h3>
<p>The distributions of (dT/dz)_ρ is different from (dT/dz)_z which is maybe not surprising but the difference is a factor of 2, this makes me suspicious.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dTi</span><span class="p">,</span> <span class="n">dTd</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">calc_iso_dia_gradients</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>
<span class="n">dTi_i</span><span class="p">,</span> <span class="n">dTd_i</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">calc_iso_dia_gradients</span><span class="p">(</span><span class="n">Tdens_i</span><span class="p">,</span> <span class="n">Pdens_i</span><span class="p">)</span>

<span class="n">histargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;histtype&#39;</span><span class="p">:</span> <span class="s1">&#39;step&#39;</span><span class="p">}</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">dTi</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">histargs</span><span class="p">)</span>
<span class="n">dTi_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">histargs</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;dTiso of T interp to ρ space&#39;</span><span class="p">,</span>
              <span class="s1">&#39;dTiso of spline smooth T&#39;</span><span class="p">])</span>

<span class="n">dTd</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">histargs</span><span class="p">)</span>
<span class="n">dTd_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">histargs</span><span class="p">)</span>
<span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">histargs</span><span class="p">)</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">histargs</span><span class="p">)</span>
<span class="n">dTmdz</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">histargs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;dTdia of T interp to ρ space&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;dTdia of spline smooth T&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;local dTdz interp to ρ space&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;observed local dTdz&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;dTdz of spline smooth T after moving to z space&#39;</span><span class="p">])</span>

<span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/BoB-ctd-chipod_25_0.png" src="_images/BoB-ctd-chipod_25_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">],</span> <span class="n">Pdens_i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">Pdens_i</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">dTd_i</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>


<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.contour.QuadContourSet at 0x7f91c0646630&gt;
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_26_1.png" src="_images/BoB-ctd-chipod_26_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">],</span> <span class="n">Pdens_i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">Pdens_i</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">dTd_i</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f3310a6c828&gt;
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_27_1.png" src="_images/BoB-ctd-chipod_27_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">###################################</span>
<span class="c1"># sample mean fields along transect</span>
<span class="c1">###################################</span>
<span class="n">seltrans</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">transect</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">transect</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>

<span class="p">(</span><span class="n">eccograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">seltrans</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">))</span>
<span class="p">(</span><span class="n">eccograd</span><span class="o">.</span><span class="n">Tmean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">seltrans</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># plots</span>
<span class="n">Tdens</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu_r</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Tdens_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">trdens</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dTiso</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Tdens_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#trdens.P.plot.contour(levels=20, colors=&#39;lightgray&#39;, ax=ax[2], yincrease=False)</span>

<span class="n">dTdia</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Tdens_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Pdens_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-326-732c21cbdbbf&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> 
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="p">(</span><span class="n">eccograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">seltrans</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>  <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="p">(</span><span class="n">eccograd</span><span class="o">.</span><span class="n">Tmean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">seltrans</span><span class="p">)</span>

<span class="nn">~/work/python/xarray/xarray/core/dataarray.py</span> in <span class="ni">sel</span><span class="nt">(self, indexers, method, tolerance, drop, **indexers_kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">782</span>         <span class="n">indexers</span> <span class="o">=</span> <span class="n">either_dict_or_kwargs</span><span class="p">(</span><span class="n">indexers</span><span class="p">,</span> <span class="n">indexers_kwargs</span><span class="p">,</span> <span class="s1">&#39;sel&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">783</span>         <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_temp_dataset</span><span class="p">()</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">784</span>             <span class="n">indexers</span><span class="o">=</span><span class="n">indexers</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">785</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_temp_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">786</span> 

<span class="nn">~/work/python/xarray/xarray/core/dataset.py</span> in <span class="ni">sel</span><span class="nt">(self, indexers, method, tolerance, drop, **indexers_kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1507</span>         <span class="n">indexers</span> <span class="o">=</span> <span class="n">either_dict_or_kwargs</span><span class="p">(</span><span class="n">indexers</span><span class="p">,</span> <span class="n">indexers_kwargs</span><span class="p">,</span> <span class="s1">&#39;sel&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1508</span>         <span class="n">pos_indexers</span><span class="p">,</span> <span class="n">new_indexes</span> <span class="o">=</span> <span class="n">remap_label_indexers</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1509</span>             <span class="bp">self</span><span class="p">,</span> <span class="n">indexers</span><span class="o">=</span><span class="n">indexers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1510</span>         <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">indexers</span><span class="o">=</span><span class="n">pos_indexers</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1511</span>         <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">_replace_indexes</span><span class="p">(</span><span class="n">new_indexes</span><span class="p">)</span>

<span class="nn">~/work/python/xarray/xarray/core/coordinates.py</span> in <span class="ni">remap_label_indexers</span><span class="nt">(obj, indexers, method, tolerance, **indexers_kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span> 
<span class="g g-Whitespace">    </span><span class="mi">354</span>     <span class="n">pos_indexers</span><span class="p">,</span> <span class="n">new_indexes</span> <span class="o">=</span> <span class="n">indexing</span><span class="o">.</span><span class="n">remap_label_indexers</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">355</span>         <span class="n">obj</span><span class="p">,</span> <span class="n">v_indexers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span>     <span class="c1"># attach indexer&#39;s coordinate to pos_indexers</span>

<span class="nn">~/work/python/xarray/xarray/core/indexing.py</span> in <span class="ni">remap_label_indexers</span><span class="nt">(data_obj, indexers, method, tolerance)</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">249</span>             <span class="n">idxr</span><span class="p">,</span> <span class="n">new_idx</span> <span class="o">=</span> <span class="n">convert_label_indexer</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">250</span>                                                   <span class="n">dim</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span>             <span class="n">pos_indexers</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxr</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span>             <span class="k">if</span> <span class="n">new_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">~/work/python/xarray/xarray/core/indexing.py</span> in <span class="ni">convert_label_indexer</span><span class="nt">(index, label, index_name, method, tolerance)</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span> 
<span class="g g-Whitespace">    </span><span class="mi">146</span>     <span class="k">elif</span> <span class="n">is_dict_like</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">147</span>         <span class="n">is_nested_vals</span> <span class="o">=</span> <span class="n">_is_nested_tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot use a dict-like object for selection on &#39;</span>

<span class="ne">TypeError</span>: &#39;numpy.ndarray&#39; object is not callable
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_28_1.png" src="_images/BoB-ctd-chipod_28_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">Pdens_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(100, 0)
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_29_1.png" src="_images/BoB-ctd-chipod_29_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="ferrari-polzin-2005-approach">
<h2>Ferrari &amp; Polzin (2005) approach<a class="headerlink" href="#ferrari-polzin-2005-approach" title="Permalink to this headline">¶</a></h2>
<p>They average all data on density surfaces, estimate mean depth of isopycnal <span class="math notranslate nohighlight">\(z_n\)</span> and calculate diapycnal gradient. The result is a vertical profile of eddy diffusivity. All spatial variations are averaged over.</p>
<p>They calculate an isopycnal gradient by doing a plane fit along isopycnals to all the data. This is required for the finestructure estimate</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transKe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:  (dist: 26, rho: 14)
Coordinates:
  * dist     (dist) float64 0.0 37.02 74.47 111.3 148.0 185.1 222.2 259.1 ...
  * rho      (rho) float64 1.02e+03 1.02e+03 1.021e+03 1.021e+03 1.022e+03 ...
Data variables:
    Ke       (dist, rho) float64 nan nan nan -293.5 -517.0 -2.837e+03 ...
    KT       (dist, rho) float64 nan nan 0.0003355 6.889e-08 2.743e-08 ...
    KtTz     (dist, rho) float64 nan nan 1.664e-06 4.679e-09 2.365e-09 ...
    dTdz     (dist, rho) float64 nan nan 0.004763 0.06767 0.1226 0.1494 ...
    chi      (dist, rho) float64 nan nan 1.865e-08 6.313e-10 3.188e-10 ...
    dTmdz    (dist, rho) float64 nan nan nan 0.1624 0.3492 0.3736 0.1541 ...
    dTiso    (dist, rho) float64 nan nan -1.973e-06 -1.23e-06 1.135e-06 ...
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def transect_fp(trdens):</span>

<span class="n">trdens</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="n">transect</span><span class="p">)</span>

<span class="n">dTiso</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">trdens</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                     <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="n">trdens</span><span class="o">.</span><span class="n">rho</span><span class="p">})</span>

<span class="c1"># fit straight lines to get mean gradients </span>
<span class="c1"># FP do a plane fit in 2D</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trdens</span><span class="o">.</span><span class="n">rho</span><span class="p">):</span>
    <span class="n">Tvec</span> <span class="o">=</span> <span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">rr</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Tvec</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">continue</span>
        
    <span class="n">dTiso</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">trdens</span><span class="o">.</span><span class="n">dist</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">Tvec</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="p">)</span>

<span class="n">trmean</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span>
<span class="n">trmean</span>

<span class="n">Tmean</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">trmean</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="s1">&#39;cast&#39;</span><span class="p">]),</span> 
                          <span class="n">Pold</span><span class="o">=</span><span class="n">trmean</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="s1">&#39;cast&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span>
<span class="n">rhomean</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">trmean</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="s1">&#39;cast&#39;</span><span class="p">]),</span> 
                            <span class="n">Pold</span><span class="o">=</span><span class="n">trmean</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="s1">&#39;cast&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="p">,</span> <span class="n">Tsmooth</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">fit_spline</span><span class="p">(</span><span class="n">Tmean</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">Tmean</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Tmean.plot()</span>
<span class="n">dTdz</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">xgradient</span><span class="p">(</span><span class="o">-</span><span class="n">Tsmooth</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
<span class="n">dTdz</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhomean</span>

<span class="n">dTdz</span> <span class="o">=</span> <span class="n">dTdz</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="s1">&#39;cast&#39;</span><span class="p">])</span>
<span class="n">dTdz</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dTdz</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="s1">&#39;cast&#39;</span><span class="p">])</span>

<span class="n">dTmdz</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="n">dTdz</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span>

<span class="n">fpKe</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="n">fpKe</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean</span><span class="o">.</span><span class="n">chi</span>
<span class="n">fpKe</span><span class="p">[</span><span class="s1">&#39;dTmdz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean</span><span class="o">.</span><span class="n">dTdz</span>
<span class="n">fpKe</span><span class="p">[</span><span class="s1">&#39;dTiso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dTiso</span>
<span class="n">fpKe</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean</span><span class="o">.</span><span class="n">KtTz</span>
<span class="n">fpKe</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean</span><span class="o">.</span><span class="n">KT</span>
<span class="n">fpKe</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean</span><span class="o">.</span><span class="n">dTdz</span>

<span class="n">fpKe</span><span class="p">[</span><span class="s1">&#39;Ke&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fpKe</span><span class="o">.</span><span class="n">chi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">fpKe</span><span class="o">.</span><span class="n">KtTz</span> <span class="o">*</span> <span class="n">fpKe</span><span class="o">.</span><span class="n">dTmdz</span><span class="p">)</span><span class="o">/</span><span class="n">fpKe</span><span class="o">.</span><span class="n">dTiso</span><span class="o">**</span><span class="mi">2</span>

<span class="n">ed</span><span class="o">.</span><span class="n">plot_bar_Ke</span><span class="p">(</span><span class="n">fpKe</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-323-721f90866cb5&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># def transect_fp(trdens):</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">trdens</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="n">transect</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">dTiso</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">trdens</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>

<span class="nn">~/work/eddydiff/eddydiff/eddydiff.py</span> in <span class="ni">to_density_space</span><span class="nt">(da, rhonew)</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span>     <span class="n">in_dens</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">200</span> 
<span class="ne">--&gt; </span><span class="mi">201</span>     <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">da</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span>         <span class="k">if</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">da</span><span class="o">.</span><span class="n">coords</span> <span class="ow">or</span> <span class="n">vv</span> <span class="o">==</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">203</span>             <span class="k">continue</span>

<span class="nn">~/anaconda3/lib/python3.6/site-packages/pandas/core/generic.py</span> in <span class="ni">__getattr__</span><span class="nt">(self, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">4370</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_axis</span><span class="o">.</span><span class="n">_can_hold_identifiers_and_holds_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">4371</span>                 <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<span class="ne">-&gt; </span><span class="mi">4372</span>             <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">4373</span> 
<span class="g g-Whitespace">   </span><span class="mi">4374</span>     <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

<span class="ne">AttributeError</span>: &#39;DataFrame&#39; object has no attribute &#39;variables&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="without-interpolating-to-convert-to-density-space">
<h2>Without interpolating to convert to density space<a class="headerlink" href="#without-interpolating-to-convert-to-density-space" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span><span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ed</span><span class="o">.</span><span class="n">fit_spline</span><span class="p">(</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
              <span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="mi">5</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;scipy.interpolate.fitpack2.UnivariateSpline at 0x7f917a7ad6d8&gt;,
 array([26.25453411, 26.27269832, 26.26237948, 26.22850841, 26.17573395,
        26.10729261, 26.02839219, 25.94359928, 25.85682278, 25.77302511,
        25.69583305, 25.63065117, 25.58101885, 25.55179105, 25.54613198,
        25.56238605, 25.59792679, 25.64976453, 25.7146301 , 25.79062798,
        25.79063393, 25.87376963, 25.95664316, 26.02779096, 26.08732754,
        26.10676851, 26.07836197]))
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_34_1.png" src="_images/BoB-ctd-chipod_34_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Section 1.3 first</span>
<span class="c1"># 2. Generate mean field T, P using cubic splines to smooth</span>
<span class="c1">#    Calculate Trms as RMS of deviations from smoothed T field</span>

<span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Tmean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">smooth_cubic_spline</span><span class="p">(</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
<span class="n">trmean_rho</span><span class="o">.</span><span class="n">Tmean</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Smoothed temperature&#39;</span>

<span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Pmean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">smooth_cubic_spline</span><span class="p">(</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>
<span class="n">trmean_rho</span><span class="o">.</span><span class="n">Pmean</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Smoothed pressure&#39;</span>


<span class="k">def</span> <span class="nf">check_spline_smoothing</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Ts</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Ps</span><span class="p">,</span> <span class="n">Traw</span><span class="p">,</span> <span class="n">Praw</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">Ts</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">P</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">Ps</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">#cmat, rhomat = xr.broadcast(T.cast, T.rho)</span>
    <span class="c1">#ax[2].contour(cmat, P, T, levels=50, colors=&#39;r&#39;)</span>

    <span class="n">Tz</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="n">Tzs</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">Ps</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">Traw</span><span class="o">.</span><span class="n">cast</span><span class="p">,</span> <span class="n">Praw</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Praw</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">Traw</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">BuGn</span><span class="p">)</span>
    <span class="n">Tz</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">Tzs</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                     <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Smoothed temp&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Smoothed pressure&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Raw and smoothed temperature in depth space&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">220</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>


<span class="n">check_spline_smoothing</span><span class="p">(</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Tmean&#39;</span><span class="p">],</span>
                       <span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Pmean&#39;</span><span class="p">],</span>
                       <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;pres&#39;</span><span class="p">])</span>

<span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Trms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="p">((</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Tmean&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">))</span>
<span class="n">trmean_rho</span><span class="o">.</span><span class="n">Trms</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RMS temp variations&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/numpy/core/_methods.py:29: RuntimeWarning: invalid value encountered in reduce
  return umr_minimum(a, axis, None, out, keepdims)
/home/deepak/anaconda3/lib/python3.6/site-packages/numpy/core/_methods.py:26: RuntimeWarning: invalid value encountered in reduce
  return umr_maximum(a, axis, None, out, keepdims)
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_35_1.png" src="_images/BoB-ctd-chipod_35_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3. Calculate isopyncal and diapycnal gradients of the mean field</span>
<span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;dTiso&#39;</span><span class="p">],</span> <span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;dTdia&#39;</span><span class="p">]</span> <span class="o">=</span> \
    <span class="n">ed</span><span class="o">.</span><span class="n">calc_iso_dia_gradients</span><span class="p">(</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Tmean&#39;</span><span class="p">],</span> <span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Pmean&#39;</span><span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">trmean_rho</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Isopycnal ∇T&#39;</span>
<span class="n">trmean_rho</span><span class="o">.</span><span class="n">dTdia</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Diapycnal ∇T&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/BoB-ctd-chipod_36_0.png" src="_images/BoB-ctd-chipod_36_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transKe</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean_rho</span><span class="o">.</span><span class="n">KT</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean_rho</span><span class="o">.</span><span class="n">KtTz</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean_rho</span><span class="o">.</span><span class="n">dTdz</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean_rho</span><span class="o">.</span><span class="n">chi</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;dTmdz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean_rho</span><span class="o">.</span><span class="n">dTdia</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;dTiso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean_rho</span><span class="o">.</span><span class="n">dTiso</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">transKe</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;Tm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;Tmean&#39;</span><span class="p">]</span>
<span class="n">transKe</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BoB CTD χpod&#39;</span>


<span class="k">def</span> <span class="nf">calc_Ke</span><span class="p">(</span><span class="n">transKe</span><span class="p">,</span> <span class="n">navg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">transKe</span> <span class="o">=</span> <span class="n">transKe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">navg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">navg</span><span class="p">):</span>
        <span class="n">transKe</span> <span class="o">=</span> <span class="n">transKe</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">navg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">transKe</span><span class="o">.</span><span class="n">cast</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">transKe</span><span class="o">.</span><span class="n">cast</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">navg</span><span class="p">)</span>
        <span class="n">transKe</span> <span class="o">=</span> <span class="p">(</span><span class="n">transKe</span><span class="o">.</span><span class="n">groupby_bins</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">cbins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">cbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">))</span>

     
    <span class="n">transKe</span><span class="p">[</span><span class="s1">&#39;Ke&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">transKe</span><span class="o">.</span><span class="n">chi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">transKe</span><span class="o">.</span><span class="n">KtTz</span> <span class="o">*</span>
                     <span class="n">transKe</span><span class="o">.</span><span class="n">dTmdz</span><span class="p">)</span><span class="o">/</span><span class="n">transKe</span><span class="o">.</span><span class="n">dTiso</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">transKe</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">transKe</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">5e-7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">transKe</span><span class="o">.</span><span class="n">Ke</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;$K_e$&#39;</span>
    
    <span class="n">transKe</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;navg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">navg</span>
    
    <span class="k">if</span> <span class="s1">&#39;cast_bins&#39;</span> <span class="ow">in</span> <span class="n">transKe</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
        <span class="n">transKe</span> <span class="o">=</span> <span class="n">transKe</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;cast_bins&#39;</span><span class="p">:</span> <span class="s1">&#39;cast&#39;</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">transKe</span>


<span class="n">transKe</span> <span class="o">=</span> <span class="n">calc_Ke</span><span class="p">(</span><span class="n">transKe</span><span class="p">)</span>

<span class="n">ed</span><span class="o">.</span><span class="n">plot_transect_Ke</span><span class="p">(</span><span class="n">transKe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:28: RuntimeWarning: invalid value encountered in less
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_37_1.png" src="_images/BoB-ctd-chipod_37_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transKe2</span> <span class="o">=</span> <span class="n">calc_Ke</span><span class="p">(</span><span class="n">transKe</span><span class="p">,</span> <span class="n">navg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">axback</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">plot_transect_var</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">transKe2</span><span class="o">.</span><span class="n">Ke</span><span class="p">,</span>
                               <span class="n">fill</span><span class="o">=</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;dTiso&#39;</span><span class="p">],</span> <span class="n">contour</span><span class="o">=</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span>
                               <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">],</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="mf">1e3</span><span class="p">])</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">axback</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">plot_transect_var</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">transKe2</span><span class="o">.</span><span class="n">chi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> 
                               <span class="n">bar2</span><span class="o">=</span><span class="n">transKe2</span><span class="o">.</span><span class="n">KtTz</span> <span class="o">*</span> <span class="n">transKe2</span><span class="o">.</span><span class="n">dTmdz</span><span class="p">,</span>
                               <span class="n">fill</span><span class="o">=</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">contour</span><span class="o">=</span><span class="n">trmean_rho</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:28: RuntimeWarning: invalid value encountered in less
/home/deepak/anaconda3/lib/python3.6/site-packages/matplotlib/contour.py:1173: UserWarning: No contour levels were found within the data range.
  warnings.warn(&quot;No contour levels were found&quot;
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_38_1.png" src="_images/BoB-ctd-chipod_38_1.png" />
<img alt="_images/BoB-ctd-chipod_38_2.png" src="_images/BoB-ctd-chipod_38_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transKe2</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">])</span>

<span class="n">cole</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">read_cole</span><span class="p">()</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">get_region_from_transect</span><span class="p">(</span><span class="n">transect</span><span class="p">)</span>

<span class="n">cole_bay</span> <span class="o">=</span> <span class="p">(</span><span class="n">cole</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
<span class="n">cole_bay</span><span class="p">[</span><span class="s1">&#39;density_mean_depth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1000</span>
<span class="n">cole_bay</span> <span class="o">=</span> <span class="n">cole_bay</span><span class="o">.</span><span class="n">set_coords</span><span class="p">(</span><span class="s1">&#39;density_mean_depth&#39;</span><span class="p">)</span>
<span class="n">cole_bay</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;density_mean_depth&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f91bf98f860&gt;]
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_39_1.png" src="_images/BoB-ctd-chipod_39_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transKe2</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">transKe2</span><span class="o">.</span><span class="n">Ke</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="n">cole_bay</span> <span class="o">=</span> <span class="p">(</span><span class="n">cole</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
<span class="n">cole_bay</span><span class="p">[</span><span class="s1">&#39;density_mean_depth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1000</span>
<span class="n">cole_bay</span> <span class="o">=</span> <span class="n">cole_bay</span><span class="o">.</span><span class="n">set_coords</span><span class="p">(</span><span class="s1">&#39;density_mean_depth&#39;</span><span class="p">)</span>
<span class="n">cole_bay</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;density_mean_depth&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">([</span><span class="s1">&#39;Mean in along-transect direction&#39;</span><span class="p">,</span> <span class="s1">&#39;Cole et al (2015)&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f91bfb673c8&gt;
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_40_1.png" src="_images/BoB-ctd-chipod_40_1.png" />
</div>
</div>
</div>
<div class="section" id="compare-various-mean-fields-gradients">
<h2>Compare various mean fields / gradients<a class="headerlink" href="#compare-various-mean-fields-gradients" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">argo</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/argo_clim_iso_gradients.nc&#39;</span><span class="p">,</span>
                       <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="n">ecco</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/ecco_annual_iso_gradient.nc&#39;</span><span class="p">,</span>
                       <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">region</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">get_region_from_transect</span><span class="p">(</span><span class="n">transect</span><span class="p">)</span>

<span class="n">argo</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">region</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ecco</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">region</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">trmean_rho</span><span class="o">.</span><span class="n">dTiso</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f1c7a70b9e8&gt;
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_43_1.png" src="_images/BoB-ctd-chipod_43_1.png" />
<img alt="_images/BoB-ctd-chipod_43_2.png" src="_images/BoB-ctd-chipod_43_2.png" />
<img alt="_images/BoB-ctd-chipod_43_3.png" src="_images/BoB-ctd-chipod_43_3.png" />
</div>
</div>
</div>
<div class="section" id="argo-estimate-cole-et-al-2015">
<h2>Argo estimate (Cole et al, 2015)<a class="headerlink" href="#argo-estimate-cole-et-al-2015" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">region</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">get_region_from_transect</span><span class="p">(</span><span class="n">transect</span><span class="p">)</span>

<span class="n">cole_bay</span> <span class="o">=</span> <span class="p">(</span><span class="n">cole</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">lon</span><span class="o">=</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]))</span>

<span class="p">(</span><span class="n">cole_bay</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
       <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span>
       <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(200, 0)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/matplotlib/colors.py:1031: RuntimeWarning: invalid value encountered in less_equal
  mask |= resdat &lt;= 0
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_45_2.png" src="_images/BoB-ctd-chipod_45_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cole_bay</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">3e4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/BoB-ctd-chipod_46_0.png" src="_images/BoB-ctd-chipod_46_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cole_bay</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">groupby_bins</span><span class="p">(</span><span class="n">cole_bay</span><span class="o">.</span><span class="n">density_mean_depth</span><span class="o">+</span><span class="mi">1000</span><span class="p">,</span>
                                   <span class="n">ρbins</span><span class="p">,</span>
                                   <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="n">ρbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ρbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;density_mean_depth_bins&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f91cf175dd8&gt;]
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_47_1.png" src="_images/BoB-ctd-chipod_47_1.png" />
</div>
</div>
</div>
<div class="section" id="all-data-combined">
<h2>All data combined<a class="headerlink" href="#all-data-combined" title="Permalink to this headline">¶</a></h2>
<p>Let’s ignore 3 for now, not sure why that overlaps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transect1</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/bob-ctd-chipod/transect_1.nc&#39;</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">transect2</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/bob-ctd-chipod/transect_2.nc&#39;</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">transect3</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../datasets/bob-ctd-chipod/transect_3.nc&#39;</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">transect1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">transect1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">transect2</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">transect2</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">transect3</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">transect3</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;big(1)&#39;</span><span class="p">,</span> <span class="s1">&#39;big(2)&#39;</span><span class="p">,</span> <span class="s1">&#39;big(3)&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fb11cb45390&gt;
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_50_1.png" src="_images/BoB-ctd-chipod_50_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merge transect 1 and transect2</span>
<span class="n">transect</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tr</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                      <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="p">[</span><span class="n">transect1</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">))]])</span>

<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;dTdz&#39;</span><span class="p">]</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1025</span> <span class="o">*</span> <span class="mi">4200</span> <span class="o">*</span> <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">,</span>
                     <span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">&gt;</span> <span class="mf">5e-3</span><span class="p">)</span>

<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;Jq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;chi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">eccoKe2</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">process_transect_1d</span><span class="p">(</span><span class="n">transect</span><span class="p">,</span> <span class="n">eccograd</span><span class="p">,</span> <span class="s1">&#39;ECCO&#39;</span><span class="p">)</span>
<span class="n">argoKe2</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">process_transect_1d</span><span class="p">(</span><span class="n">transect</span><span class="p">,</span> <span class="n">argograd</span><span class="p">,</span> <span class="s1">&#39;ARGO&#39;</span><span class="p">)</span>

<span class="n">ed</span><span class="o">.</span><span class="n">plot_bar_Ke</span><span class="p">(</span><span class="n">eccoKe2</span><span class="p">)</span>
<span class="n">ed</span><span class="o">.</span><span class="n">plot_bar_Ke</span><span class="p">(</span><span class="n">argoKe2</span><span class="p">)</span>

<span class="n">eccoKe2</span><span class="o">.</span><span class="n">Ke</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:8: RuntimeWarning: invalid value encountered in greater
  
/home/deepak/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:9: RuntimeWarning: invalid value encountered in greater
  if __name__ == &#39;__main__&#39;:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rho
(1019.0, 1020.6]      3938.569746
(1020.6, 1021.2]     10729.992555
(1021.2, 1022.7]     46947.664696
(1022.7, 1023.9]     -2230.156607
(1023.9, 1024.7]     -5942.732091
(1024.7, 1025.4]     48277.446666
(1025.4, 1026.0]     89531.725066
(1026.0, 1026.5]    316205.497546
(1026.5, 1026.9]     47694.340619
(1026.9, 1027.5]    -50417.990562
Name: Ke, dtype: float64
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_51_2.png" src="_images/BoB-ctd-chipod_51_2.png" />
<img alt="_images/BoB-ctd-chipod_51_3.png" src="_images/BoB-ctd-chipod_51_3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transect1</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu_r</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">transect1</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> 
                                                     <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1020</span><span class="p">,</span> <span class="mi">1028</span><span class="p">),</span> 
                                                     <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="p">(</span><span class="n">eccograd</span><span class="p">[</span><span class="s1">&#39;ρmean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">ed</span><span class="o">.</span><span class="n">get_region_from_transect</span><span class="p">(</span><span class="n">transect1</span><span class="p">))</span>
 <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1020</span><span class="p">,</span> <span class="mi">1028</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(200, 0)
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_52_1.png" src="_images/BoB-ctd-chipod_52_1.png" />
<img alt="_images/BoB-ctd-chipod_52_2.png" src="_images/BoB-ctd-chipod_52_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trmean</span><span class="p">,</span> <span class="n">ρbins</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">average_transect_1d</span><span class="p">(</span><span class="n">transect</span><span class="p">)</span>
    
<span class="n">eccomean</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">average_clim</span><span class="p">(</span><span class="n">eccograd</span><span class="p">,</span> <span class="n">transect</span><span class="p">,</span> <span class="n">ρbins</span><span class="p">)</span>

<span class="n">eccomean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lat</th>
      <th>lon</th>
      <th>pres</th>
      <th>Tmean</th>
      <th>Smean</th>
      <th>RHOAnoma</th>
      <th>ρmean</th>
      <th>dTiso</th>
      <th>dTdia</th>
      <th>dSiso</th>
      <th>dSdia</th>
      <th>dTdz_local</th>
      <th>dSdz</th>
      <th>Pmean</th>
      <th>dTdz</th>
    </tr>
    <tr>
      <th>ρmean</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(1019.1, 1020.7]</th>
      <td>16.507143</td>
      <td>87.464286</td>
      <td>10.333333</td>
      <td>28.939016</td>
      <td>32.836595</td>
      <td>-8.500231</td>
      <td>1020.499769</td>
      <td>7.333585e-07</td>
      <td>0.005335</td>
      <td>1.824942e-06</td>
      <td>0.013389</td>
      <td>0.005335</td>
      <td>-0.013389</td>
      <td>10.333333</td>
      <td>0.032508</td>
    </tr>
    <tr>
      <th>(1020.7, 1021.2]</th>
      <td>12.984742</td>
      <td>87.032864</td>
      <td>14.647887</td>
      <td>28.798760</td>
      <td>33.449447</td>
      <td>-7.972470</td>
      <td>1021.027530</td>
      <td>6.038192e-07</td>
      <td>0.011383</td>
      <td>9.272963e-07</td>
      <td>0.009727</td>
      <td>0.011383</td>
      <td>-0.009727</td>
      <td>14.647887</td>
      <td>0.032730</td>
    </tr>
    <tr>
      <th>(1021.2, 1022.5]</th>
      <td>12.422030</td>
      <td>86.626856</td>
      <td>39.381188</td>
      <td>27.957727</td>
      <td>33.956771</td>
      <td>-7.209345</td>
      <td>1021.790655</td>
      <td>8.870507e-07</td>
      <td>0.054069</td>
      <td>5.606805e-07</td>
      <td>0.020746</td>
      <td>0.054069</td>
      <td>-0.020746</td>
      <td>39.381188</td>
      <td>0.053711</td>
    </tr>
    <tr>
      <th>(1022.5, 1023.4]</th>
      <td>12.877078</td>
      <td>86.702494</td>
      <td>67.187101</td>
      <td>25.848192</td>
      <td>34.483206</td>
      <td>-6.026892</td>
      <td>1022.973108</td>
      <td>9.335261e-07</td>
      <td>0.107467</td>
      <td>4.611139e-07</td>
      <td>0.014878</td>
      <td>0.107467</td>
      <td>-0.014878</td>
      <td>67.187101</td>
      <td>0.100398</td>
    </tr>
    <tr>
      <th>(1023.4, 1024.2]</th>
      <td>13.092742</td>
      <td>86.763441</td>
      <td>84.984611</td>
      <td>23.781918</td>
      <td>34.670366</td>
      <td>-5.187314</td>
      <td>1023.812686</td>
      <td>7.491000e-07</td>
      <td>0.123242</td>
      <td>3.328542e-07</td>
      <td>0.008024</td>
      <td>0.123242</td>
      <td>-0.008024</td>
      <td>84.984611</td>
      <td>0.126546</td>
    </tr>
    <tr>
      <th>(1024.2, 1024.7]</th>
      <td>12.621930</td>
      <td>86.674561</td>
      <td>98.163965</td>
      <td>22.012167</td>
      <td>34.765387</td>
      <td>-4.548118</td>
      <td>1024.451882</td>
      <td>6.128813e-07</td>
      <td>0.117844</td>
      <td>2.484168e-07</td>
      <td>0.004501</td>
      <td>0.117844</td>
      <td>-0.004500</td>
      <td>98.163965</td>
      <td>0.120330</td>
    </tr>
    <tr>
      <th>(1024.7, 1025.2]</th>
      <td>12.814516</td>
      <td>86.855572</td>
      <td>113.221291</td>
      <td>20.440335</td>
      <td>34.814054</td>
      <td>-4.011924</td>
      <td>1024.988076</td>
      <td>4.669423e-07</td>
      <td>0.104717</td>
      <td>1.765324e-07</td>
      <td>0.003152</td>
      <td>0.104717</td>
      <td>-0.003152</td>
      <td>113.221291</td>
      <td>0.103577</td>
    </tr>
    <tr>
      <th>(1025.2, 1025.7]</th>
      <td>12.620301</td>
      <td>86.759398</td>
      <td>127.308123</td>
      <td>18.991971</td>
      <td>34.855904</td>
      <td>-3.536118</td>
      <td>1025.463882</td>
      <td>3.916333e-07</td>
      <td>0.093500</td>
      <td>1.250950e-07</td>
      <td>0.002424</td>
      <td>0.093500</td>
      <td>-0.002424</td>
      <td>127.308123</td>
      <td>0.111689</td>
    </tr>
    <tr>
      <th>(1025.7, 1026.0]</th>
      <td>11.579341</td>
      <td>86.423653</td>
      <td>136.347489</td>
      <td>17.930917</td>
      <td>34.884922</td>
      <td>-3.205289</td>
      <td>1025.794711</td>
      <td>4.132742e-07</td>
      <td>0.082132</td>
      <td>9.679136e-08</td>
      <td>0.001976</td>
      <td>0.082132</td>
      <td>-0.001976</td>
      <td>136.347489</td>
      <td>0.101579</td>
    </tr>
    <tr>
      <th>(1026.0, 1026.5]</th>
      <td>12.843915</td>
      <td>86.653439</td>
      <td>157.727486</td>
      <td>16.558279</td>
      <td>34.917639</td>
      <td>-2.753373</td>
      <td>1026.246627</td>
      <td>3.859926e-07</td>
      <td>0.072626</td>
      <td>6.896777e-08</td>
      <td>0.001861</td>
      <td>0.072626</td>
      <td>-0.001861</td>
      <td>157.727486</td>
      <td>0.064202</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp</span><span class="p">,</span> <span class="n">Tsm</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">fit_spline</span><span class="p">(</span><span class="n">eccomean</span><span class="p">[</span><span class="s1">&#39;Pmean&#39;</span><span class="p">],</span> <span class="n">eccomean</span><span class="p">[</span><span class="s1">&#39;Tmean&#39;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="n">eccomean</span><span class="p">[</span><span class="s1">&#39;Pmean&#39;</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">eccomean</span><span class="o">.</span><span class="n">dTdz</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-22-79acc47f9c17&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">sp</span><span class="p">,</span> <span class="n">Tsm</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">fit_spline</span><span class="p">(</span><span class="n">eccomean</span><span class="p">[</span><span class="s1">&#39;Pmean&#39;</span><span class="p">],</span> <span class="n">eccomean</span><span class="p">[</span><span class="s1">&#39;Tmean&#39;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="n">eccomean</span><span class="p">[</span><span class="s1">&#39;Pmean&#39;</span><span class="p">]))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">eccomean</span><span class="o">.</span><span class="n">dTdz</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;eccomean&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lessons-learned">
<h2>Lessons learned<a class="headerlink" href="#lessons-learned" title="Permalink to this headline">¶</a></h2>
<div class="section" id="don-t-interpolate-when-converting-to-density-space">
<h3>Don’t interpolate when converting to density space<a class="headerlink" href="#don-t-interpolate-when-converting-to-density-space" title="Permalink to this headline">¶</a></h3>
<p>+The fields and gradients are different!+</p>
<p><em>FALSE ALARM: This is because transect.P and transect.pres are different!</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># transform to depth space, calculate gradient and transform back</span>
<span class="n">Tsmooth</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">Tdens_i</span><span class="p">,</span> <span class="n">Pold</span><span class="o">=</span><span class="n">Pdens_i</span><span class="p">,</span> <span class="n">Pnew</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">dTmdz</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ed</span><span class="o">.</span><span class="n">xgradient</span><span class="p">(</span><span class="n">Tsmooth</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">))</span>
<span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="n">dTmdz</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># original calculation ΔT and ΔP are estimated in density space</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">trmean_rho</span><span class="o">.</span><span class="n">dTdia</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fbee9919be0&gt;
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_57_1.png" src="_images/BoB-ctd-chipod_57_1.png" />
<img alt="_images/BoB-ctd-chipod_57_2.png" src="_images/BoB-ctd-chipod_57_2.png" />
</div>
</div>
</div>
<div class="section" id="spline-smooth-both-temperature-and-pressure">
<h3>Spline-smooth both temperature and pressure<a class="headerlink" href="#spline-smooth-both-temperature-and-pressure" title="Permalink to this headline">¶</a></h3>
<p>Below I calculate dT/dP in density space and compare that to dT/dP calculated by</p>
<ol class="simple">
<li><p>transforming spline smoothed T to pressure space</p></li>
<li><p>differentiate to get dT/dP</p></li>
<li><p>convert back to density space and plot.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trdens</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_density_space</span><span class="p">(</span><span class="n">transect</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="n">Tdens_i</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">smooth_cubic_spline</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">Pdens_i</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">smooth_cubic_spline</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
<span class="n">Tdens_i</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;In ρ space&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">Tsmooth</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">Tdens_i</span><span class="p">,</span> <span class="n">Pold</span><span class="o">=</span><span class="n">Pdens_i</span><span class="p">,</span> <span class="n">Pnew</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Tsmooth</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;To depth space using spline smoothed pressure&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">psmooth</span> <span class="o">=</span> <span class="n">dcpy</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">xfilter</span><span class="p">(</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">flen</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Tsmooth</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">Tdens_i</span><span class="p">,</span> <span class="n">Pold</span><span class="o">=</span><span class="n">psmooth</span><span class="p">,</span> <span class="n">Pnew</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Tsmooth</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;To depth space using hann smoothed pressure&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">Tsmooth</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">to_depth_space</span><span class="p">(</span><span class="n">Tdens_i</span><span class="p">,</span> <span class="n">Pold</span><span class="o">=</span><span class="n">trdens</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="n">Pnew</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">transect</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Tsmooth</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;To depth space using unsmoothed pressure&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(120, 0)
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_59_1.png" src="_images/BoB-ctd-chipod_59_1.png" />
<img alt="_images/BoB-ctd-chipod_59_2.png" src="_images/BoB-ctd-chipod_59_2.png" />
<img alt="_images/BoB-ctd-chipod_59_3.png" src="_images/BoB-ctd-chipod_59_3.png" />
<img alt="_images/BoB-ctd-chipod_59_4.png" src="_images/BoB-ctd-chipod_59_4.png" />
</div>
</div>
</div>
<div class="section" id="groupby-on-dataframe-or-xarray-consistently">
<h3>Groupby on dataframe or xarray consistently<a class="headerlink" href="#groupby-on-dataframe-or-xarray-consistently" title="Permalink to this headline">¶</a></h3>
<p>xarray seems to use a different kind of index with groupby_bins.</p>
</div>
<div class="section" id="test-gradients-in-isopycnal-planes">
<h3>Test gradients in isopycnal planes<a class="headerlink" href="#test-gradients-in-isopycnal-planes" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cast&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
          <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">200</span><span class="p">)}</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;cast&#39;</span><span class="p">])))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                 <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;cast&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="n">T</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">T</span><span class="o">.</span><span class="n">P</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">T</span><span class="o">.</span><span class="n">cast</span>
<span class="n">T</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span>

<span class="n">rho</span> <span class="o">=</span> <span class="mi">1025</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.7e-4</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">15</span><span class="p">))</span>
<span class="n">rho</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;$ρ$&#39;</span>

<span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">dT</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;cast&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">}))</span>
<span class="n">dT</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">dT</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">])</span>
<span class="n">dT</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dT&#39;</span>

<span class="n">drho</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;cast&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">}))</span>
<span class="n">drho</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">drho</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">])</span>
<span class="n">drho</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dρ&#39;</span>

<span class="n">dT</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:  (x: 50, z: 200)
Coordinates:
  * z        (z) float64 0.0 2.513 5.025 7.538 10.05 12.56 15.08 17.59 20.1 ...
  * x        (x) float64 1.0 2.0 3.0 4.0 5.0 6.0 7.0 8.0 9.0 10.0 11.0 12.0 ...
Data variables:
    dz       (z, x) float64 -0.6 -0.6 -0.6 -0.6 -0.6 -0.6 -0.6 -0.6 -0.6 ...
    dx       (z, x) float64 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 ...
    mag      (z, x) float64 0.6021 0.6021 0.6021 0.6021 0.6021 0.6021 0.6021 ...
    dy       (z, x) float64 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 ...
Attributes:
    name:     dT
</pre></div>
</div>
<img alt="_images/BoB-ctd-chipod_62_1.png" src="_images/BoB-ctd-chipod_62_1.png" />
</div>
</div>
</div>
<div class="section" id="convert-transect-mat-to-netcdf-files">
<h3>Convert transect .mat to netcdf files<a class="headerlink" href="#convert-transect-mat-to-netcdf-files" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">convert_mat_to_netcdf</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/_collections_abc.py:743: FutureWarning: iteration over an xarray.Dataset will change in xarray v0.11 to only include data variables, not coordinates. Iterate over the Dataset.variables property instead to preserve existing behavior in a forwards compatible manner.
  for key in self._mapping:
../eddydiff/eddydiff.py:571: RuntimeWarning: invalid value encountered in less
  mask2d = np.logical_or(transect[&#39;T&#39;].values &lt; 1,
../eddydiff/eddydiff.py:572: RuntimeWarning: invalid value encountered in less
  transect[&#39;S&#39;].values &lt; 1)
/home/deepak/anaconda3/lib/python3.6/_collections_abc.py:743: FutureWarning: iteration over an xarray.Dataset will change in xarray v0.11 to only include data variables, not coordinates. Iterate over the Dataset.variables property instead to preserve existing behavior in a forwards compatible manner.
  for key in self._mapping:
../eddydiff/eddydiff.py:571: RuntimeWarning: invalid value encountered in less
  mask2d = np.logical_or(transect[&#39;T&#39;].values &lt; 1,
../eddydiff/eddydiff.py:572: RuntimeWarning: invalid value encountered in less
  transect[&#39;S&#39;].values &lt; 1)
/home/deepak/anaconda3/lib/python3.6/_collections_abc.py:743: FutureWarning: iteration over an xarray.Dataset will change in xarray v0.11 to only include data variables, not coordinates. Iterate over the Dataset.variables property instead to preserve existing behavior in a forwards compatible manner.
  for key in self._mapping:
../eddydiff/eddydiff.py:571: RuntimeWarning: invalid value encountered in less
  mask2d = np.logical_or(transect[&#39;T&#39;].values &lt; 1,
../eddydiff/eddydiff.py:572: RuntimeWarning: invalid value encountered in less
  transect[&#39;S&#39;].values &lt; 1)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="equix.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">EQUIX</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="P06.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">P06 CTD χpod analysis</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Deepak Cherian<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            <div>
<script data-goatcounter="https://count.cherian.net/count"
        async src="count.js"></script>
</div>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>