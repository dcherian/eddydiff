
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>P06 CTD χpod analysis &#8212; Eddy Diffusivity</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Eddy Diffusivity</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Moored χpod analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="tao.html">
   TAO (0, 140) χpod
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="equix.html">
   EQUIX
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  CTD χpod analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="BoB-ctd-chipod.html">
   BoB ASIRI 2013 CTD χpod
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="P06.html">
   P06 CTD χpod analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sections-variance-estimate.html">
   Eddy variance generation along GO-SHIP lines
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Variance budgets
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="natre.html">
   NATRE region variance budget
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NATRE analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="natre-examine.html">
   NATRE microstructure dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="natre-finescale.html">
   NATRE micro vs finescale
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Finestructure analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="iw-fine-argo.html">
   Argo finescale estimates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="iw-fine-estimates.html">
   Existing finestructure estimates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="iw-fine-devel.html">
   Finescale Mixing Parametrizations: Development
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ancillary analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="compare-Ke-estimates.html">
   Compare different
   <span class="math notranslate nohighlight">
    \(K_e\)
   </span>
   estimates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="equix-vs-tao.html">
   χpods: EQUIX vs TAO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eqpac-ts-diagrams.html">
   T-S diagrams from TAO &amp; Argo at (0, 145W→135W)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dataset-processing.html">
   Dataset processing
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/P06-proposal.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/dcherian/eddydiff"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/dcherian/eddydiff/master?urlpath=tree/notebooks/P06-proposal.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-ctd-pod-data-and-convert-to-netcdf">
   Read CTD χpod data and convert to netCDF
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-transect-ancillary-datasets">
   Read transect + ancillary datasets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plots">
   plots
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate">
   Calculate
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-2">
   Calculate 2
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-3">
   Calculate 3
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="p06-ctd-pod-analysis">
<h1>P06 CTD χpod analysis<a class="headerlink" href="#p06-ctd-pod-analysis" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">eddydiff</span> <span class="k">as</span> <span class="nn">ed</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="kn">import</span> <span class="nn">dcpy</span>
<span class="kn">import</span> <span class="nn">seawater</span> <span class="k">as</span> <span class="nn">sw</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="read-ctd-pod-data-and-convert-to-netcdf">
<h2>Read CTD χpod data and convert to netCDF<a class="headerlink" href="#read-ctd-pod-data-and-convert-to-netcdf" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span>
    <span class="n">infile</span><span class="o">=</span><span class="s2">&quot;/home/deepak/work/eddydiff/datasets/P06/P06.mat&quot;</span><span class="p">,</span>
    <span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;/home/deepak/work/eddydiff/datasets/P06/p06-try-again.nc&quot;</span><span class="p">,</span>
    <span class="n">transect_name</span><span class="o">=</span><span class="s2">&quot;P06&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">102</span><span class="o">-</span><span class="n">a748ec0f2bb7</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">infile</span><span class="o">=</span><span class="s2">&quot;/home/deepak/work/eddydiff/datasets/P06/P06.mat&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;/home/deepak/work/eddydiff/datasets/P06/p06-try-again.nc&quot;</span><span class="p">,</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">transect_name</span><span class="o">=</span><span class="s2">&quot;P06&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>

<span class="nn">~/work/eddydiff/eddydiff/sections.py</span> in <span class="ni">to_netcdf</span><span class="nt">(infile, outfile, transect_name)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="kn">import</span> <span class="nn">seawater</span> <span class="k">as</span> <span class="nn">sw</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> 
<span class="ne">---&gt; </span><span class="mi">26</span>     <span class="n">mat</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">squeeze_me</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;grd&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> 
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="n">ctd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>

<span class="ne">KeyError</span>: &#39;grd&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matold</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s2">&quot;/home/deepak/work/eddydiff/datasets/P06/P06-means.mat&quot;</span><span class="p">)</span>
<span class="n">matold</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;__header__&#39;, &#39;__version__&#39;, &#39;__globals__&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;dnum&#39;, &#39;TPvar&#39;, &#39;eps&#39;, &#39;chi&#39;, &#39;KT&#39;, &#39;dTdz&#39;, &#39;N2&#39;, &#39;t&#39;, &#39;s&#39;, &#39;P&#39;, &#39;Jq&#39;, &#39;dist&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span>
    <span class="n">infile</span><span class="o">=</span><span class="s2">&quot;/home/deepak/work/eddydiff/datasets/P06/P06-new.mat&quot;</span><span class="p">,</span>
    <span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;/home/deepak/work/eddydiff/datasets/P06/p06-new.nc&quot;</span><span class="p">,</span>
    <span class="n">transect_name</span><span class="o">=</span><span class="s2">&quot;P06&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</div>
<hr class="docutils" />
<div class="section" id="read-transect-ancillary-datasets">
<h2>Read transect + ancillary datasets<a class="headerlink" href="#read-transect-ancillary-datasets" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">eddydiff</span> <span class="k">as</span> <span class="nn">ed</span>

<span class="n">p06</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;/home/deepak/work/eddydiff/datasets/P06/p06.nc&#39;</span><span class="p">)</span>
<span class="n">bathy</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">p06</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p06</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">3e-3</span><span class="p">)</span>
<span class="n">p06</span><span class="p">[</span><span class="s1">&#39;bathy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bathy</span>
<span class="n">p06</span><span class="p">[</span><span class="s1">&#39;KtTz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">KT</span> <span class="o">*</span> <span class="n">p06</span><span class="o">.</span><span class="n">dTdz</span>
<span class="n">p06</span>

<span class="n">eccograd</span><span class="p">,</span> <span class="n">argograd</span><span class="p">,</span> <span class="n">cole</span><span class="p">,</span> <span class="n">aber</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">read_all_datasets</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;monthly&#39;</span><span class="p">,</span> <span class="n">transect</span><span class="o">=</span><span class="n">p06</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/ipykernel_launcher.py:3: FutureWarning: The autoclose argument is no longer used by xarray.open_dataset() and is now ignored; it will be removed in a future version of xarray. If necessary, you can control the maximum number of simultaneous open files with xarray.set_options(file_cache_maxsize=...).
  This is separate from the ipykernel package so we can avoid doing imports until
/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/dask/array/numpy_compat.py:40: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">argograd</span><span class="o">.</span><span class="n">Smean</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f173e54d470&gt;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/_pytest/fixtures.py:847: DeprecationWarning: The `convert` argument is deprecated in favor of `converter`.  It will be removed after 2019/01.
  params = attr.ib(convert=attr.converters.optional(tuple))
/home/deepak/anaconda3/lib/python3.6/site-packages/_pytest/fixtures.py:849: DeprecationWarning: The `convert` argument is deprecated in favor of `converter`.  It will be removed after 2019/01.
  ids = attr.ib(default=None, convert=_ensure_immutable_ids)
</pre></div>
</div>
<img alt="_images/P06-proposal_8_2.png" src="_images/P06-proposal_8_2.png" />
</div>
</div>
</div>
<div class="section" id="plots">
<h2>plots<a class="headerlink" href="#plots" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span>
<span class="n">p06</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">levels</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">20</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">cast</span><span class="p">,</span> <span class="mi">6100</span><span class="p">,</span> <span class="o">-</span><span class="n">p06</span><span class="o">.</span><span class="n">bathy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="o">/</span><span class="mf">1.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/P06-proposal_10_0.png" src="_images/P06-proposal_10_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p06</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu</span><span class="p">)</span>
<span class="n">p06</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">levels</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">20</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">cast</span><span class="p">,</span> <span class="mi">6100</span><span class="p">,</span> <span class="o">-</span><span class="n">p06</span><span class="o">.</span><span class="n">bathy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="o">/</span><span class="mf">1.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/P06-proposal_11_0.png" src="_images/P06-proposal_11_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sciviscolor</span> <span class="k">as</span> <span class="nn">svc</span>

<span class="n">svc</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p06</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1">### p06[&#39;KT&#39;].attrs[&#39;long_name&#39;] = &#39;$K_T$&#39;</span>
<span class="n">p06</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m$^2$/s&#39;</span>
<span class="n">p06</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Pressure&#39;</span>
<span class="n">p06</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dbar&#39;</span>
<span class="n">p06</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Longitude&#39;</span>
<span class="n">p06</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;deg. East&#39;</span>

<span class="n">logKT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">p06</span><span class="p">[</span><span class="s1">&#39;KT&#39;</span><span class="p">])</span>
<span class="n">logKT</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">KT</span><span class="o">.</span><span class="n">attrs</span>
<span class="n">logKT</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;log$_</span><span class="si">{10}</span><span class="s1">$ $K_T$&#39;</span>
<span class="n">logKT</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu_r</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">sigma_4</span> <span class="o">-</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> 
                                  <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">levels</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">sigma_4</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="mi">6100</span><span class="p">,</span> <span class="o">-</span><span class="n">p06</span><span class="o">.</span><span class="n">bathy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Potential density contours and log $K_T$ for the P06 GOSHIP section&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../images/p06-kt.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/anaconda3/lib/python3.6/site-packages/matplotlib/contour.py:1000: UserWarning: The following kwargs were not used by contour: &#39;labels&#39;
  s)
</pre></div>
</div>
<img alt="_images/P06-proposal_14_1.png" src="_images/P06-proposal_14_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1024.6</span><span class="p">,</span> 
        <span class="mf">1025.6</span><span class="p">,</span> <span class="mf">1025.8</span><span class="p">,</span> 
        <span class="mf">1026.0</span><span class="p">,</span> <span class="mf">1026.25</span><span class="p">,</span> <span class="mf">1026.5</span><span class="p">,</span> <span class="mf">1026.75</span><span class="p">,</span> 
        <span class="mf">1027.0</span><span class="p">,</span> <span class="mf">1027.1</span><span class="p">,</span> <span class="mf">1027.2</span><span class="p">,</span> <span class="mf">1027.3</span><span class="p">,</span> <span class="mf">1027.4</span><span class="p">,</span> <span class="mf">1027.5</span><span class="p">,</span> <span class="mf">1027.6</span><span class="p">,</span> <span class="mf">1027.7</span><span class="p">,</span> <span class="mf">1027.8</span><span class="p">,</span> <span class="mf">1027.9</span><span class="p">]</span>
<span class="n">dcpy</span><span class="o">.</span><span class="n">oceans</span><span class="o">.</span><span class="n">TSplot</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">p06</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">p06</span><span class="o">.</span><span class="n">pres</span><span class="p">,</span> <span class="n">rho_levels</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/P06-proposal_15_0.png" src="_images/P06-proposal_15_0.png" />
</div>
</div>
<hr class="docutils" />
</div>
<hr class="docutils" />
<div class="section" id="calculate">
<h2>Calculate<a class="headerlink" href="#calculate" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbins</span> <span class="o">=</span> <span class="mi">18</span>

<span class="n">p06</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p06</span><span class="p">[</span><span class="s1">&#39;sigma_0&#39;</span><span class="p">]</span>
<span class="n">eccograd</span><span class="p">[</span><span class="s1">&#39;ρmean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eccograd</span><span class="p">[</span><span class="s1">&#39;sigma_0&#39;</span><span class="p">]</span>


<span class="n">eccoKe</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">process_transect_1d</span><span class="p">(</span><span class="n">p06</span><span class="p">,</span> <span class="n">eccograd</span><span class="p">,</span> <span class="s1">&#39;ECCO&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">ed</span><span class="o">.</span><span class="n">plot_bar_Ke</span><span class="p">(</span><span class="n">eccoKe</span><span class="p">,</span> <span class="n">Ke_log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">argoKe</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">process_transect_1d</span><span class="p">(</span><span class="n">p06</span><span class="p">,</span> <span class="n">argograd</span><span class="p">,</span> <span class="s1">&#39;ARGO&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">ed</span><span class="o">.</span><span class="n">plot_bar_Ke</span><span class="p">(</span><span class="n">argoKe</span><span class="p">,</span> <span class="n">Ke_log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/P06-proposal_17_0.png" src="_images/P06-proposal_17_0.png" />
<img alt="_images/P06-proposal_17_1.png" src="_images/P06-proposal_17_1.png" />
</div>
</div>
<hr class="docutils" />
</div>
<hr class="docutils" />
<div class="section" id="calculate-2">
<h2>Calculate 2<a class="headerlink" href="#calculate-2" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">eddydiff</span> <span class="k">as</span> <span class="nn">ed</span>

<span class="n">p06</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s2">&quot;/home/deepak/work/eddydiff/datasets/P06/p06.nc&quot;</span><span class="p">)</span>
<span class="n">bathy</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">p06</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p06</span><span class="p">[</span><span class="s2">&quot;KT&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">)</span>
<span class="n">p06</span><span class="p">[</span><span class="s2">&quot;bathy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bathy</span>
<span class="n">p06</span><span class="p">[</span><span class="s2">&quot;KtTz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">KT</span> <span class="o">*</span> <span class="n">p06</span><span class="o">.</span><span class="n">dTdz</span>
<span class="n">p06</span>

<span class="k">if</span> <span class="s2">&quot;eccograd&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
    <span class="n">eccograd</span><span class="p">,</span> <span class="n">argograd</span><span class="p">,</span> <span class="n">cole</span><span class="p">,</span> <span class="n">aber</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">read_all_datasets</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">,</span> <span class="n">transect</span><span class="o">=</span><span class="n">p06</span><span class="p">)</span>

<span class="c1"># use sigma_0</span>
<span class="n">p06</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p06</span><span class="p">[</span><span class="s2">&quot;sigma_0&quot;</span><span class="p">]</span>
<span class="n">eccograd</span><span class="p">[</span><span class="s2">&quot;ρmean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eccograd</span><span class="p">[</span><span class="s2">&quot;sigma_0&quot;</span><span class="p">]</span>

<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1024.6</span><span class="p">,</span>
        <span class="mf">1025.6</span><span class="p">,</span> <span class="mf">1025.8</span><span class="p">,</span>
        <span class="mf">1026.0</span><span class="p">,</span> <span class="mf">1026.15</span><span class="p">,</span> <span class="mf">1026.3</span><span class="p">,</span> <span class="mf">1026.45</span><span class="p">,</span> <span class="mf">1026.6</span><span class="p">,</span> <span class="mf">1026.8</span><span class="p">,</span> 
        <span class="mf">1027.0</span><span class="p">,</span> <span class="mf">1027.1</span><span class="p">,</span> <span class="mf">1027.2</span><span class="p">,</span> <span class="mf">1027.3</span><span class="p">,</span> <span class="mf">1027.4</span><span class="p">,</span> <span class="mf">1027.5</span><span class="p">,</span> <span class="mf">1027.6</span><span class="p">,</span> <span class="mf">1027.7</span><span class="p">,</span> <span class="mf">1027.8</span><span class="p">,</span> <span class="mf">1027.9</span><span class="p">]</span>
<span class="n">trdens</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">bin_to_density_space</span><span class="p">(</span><span class="n">p06</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>

<span class="n">eccograd</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">dist</span>
<span class="n">eccodens</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">bin_to_density_space</span><span class="p">(</span><span class="n">eccograd</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;ρmean&quot;</span><span class="p">:</span> <span class="s2">&quot;rho&quot;</span><span class="p">}),</span> <span class="n">bins</span><span class="p">)</span>

<span class="n">newKe</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;KT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">KT</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;chi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">chi</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;KtTz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">KtTz</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTiso&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">))</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTmdz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dTdz</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">))</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTdz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">dTdz</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span>

<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;Ke&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;chi&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;KtTz&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTmdz&quot;</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span>
    <span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTiso&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="p">)</span>

<span class="n">ed</span><span class="o">.</span><span class="n">plot_bar_Ke</span><span class="p">(</span><span class="n">newKe</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/dask/array/numpy_compat.py:40: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
</pre></div>
</div>
<img alt="_images/P06-proposal_19_1.png" src="_images/P06-proposal_19_1.png" />
</div>
</div>
<p>The above really awesome plot results after a few tweaks.</p>
<ol class="simple">
<li><p>Doing things in σ_0.</p></li>
<li><p>Handcrafted density bins using the T-S diagram as guide.
This is really important. Had to fiddle around slightly to not get negative
values. Biggest improvement is that I can now resolve thermocline and coarsen
the abyss. This is necessary because the big signal is in the thermocline and
the abyssal values need to account for topography. Automatically choosing
bins by pandas.cut/pandas.qcut would put too many bins down deep and fewer in
the thermocline.</p></li>
<li><p>Throwing out all KT &gt; 1e-3. This is really important. Will need to QC the
values coming out of the CTD_chipod analysis code.</p></li>
<li><p>Redid (vectorized) the bin-averaging by cast. This is a better way to do it I
think. Have to use pandas so I can groupby using multiple variables.</p></li>
<li><p>I tried fitting straight lines to the bin-averaged ECCO field to get dTiso
but this seems to under-estimate values. Currently I bin-average dTiso and
use that. This might not be crazy because it mirrors what I do with χ and we
know that χ has to go along with the appropriate local gradients. i.e. if
high χ coincides with high dTiso locally, we want the averaged dTiso to be
biased high since averaged χ will be biased high.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">Trms</span> <span class="o">=</span> <span class="n">trdens</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span>
<span class="n">Trms</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;RMS potential temp.&quot;</span>
<span class="n">Trms</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;°C&quot;</span>
<span class="n">Trms</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$σ_0$ [kg/m$^3$]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$σ_0$ [kg/m$^3$]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$K_e [m^2/s^2]$ &quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">trdens</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">),</span> <span class="s2">&quot;.-&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cole</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">),</span> <span class="n">cole</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;χpod estimate&quot;</span><span class="p">,</span> <span class="s2">&quot;Cole et al. (2015)&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pressure [dbar]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$K_e [m^2/s]$ &quot;</span><span class="p">)</span>

<span class="n">dcpy</span><span class="o">.</span><span class="n">oceans</span><span class="o">.</span><span class="n">TSplot</span><span class="p">(</span>
    <span class="n">p06</span><span class="o">.</span><span class="n">S</span><span class="p">,</span>
    <span class="n">p06</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">],</span>
    <span class="n">rho_levels</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
    <span class="n">hexbin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">plot_distrib</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">transect_name</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../images/p06.png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/work/python/xarray/xarray/core/nanops.py:142: RuntimeWarning: Mean of empty slice
  return np.nanmean(a, axis=axis, dtype=dtype)
</pre></div>
</div>
<img alt="_images/P06-proposal_21_1.png" src="_images/P06-proposal_21_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">zvec</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span>
<span class="n">rhovec</span> <span class="o">=</span> <span class="n">newKe</span><span class="o">.</span><span class="n">rho</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span><span class="p">,</span> <span class="n">zvec</span><span class="p">,</span> <span class="s2">&quot;.-&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cole</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">),</span> <span class="n">cole</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pressure [dbar]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transect-wide mean $K_e [m^2/s]$ &quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># https://matplotlib.org/gallery/subplots_axes_and_figures/fahrenheit_celsius_scales.html</span>
<span class="n">ax_z</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax_rho</span> <span class="o">=</span> <span class="n">ax_z</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax_rho</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ax_z</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">())</span>
<span class="n">ax_rho</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">ax_rho</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rr</span> <span class="o">-</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ax_z</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">(),</span> <span class="n">zvec</span><span class="p">,</span> <span class="n">rhovec</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">ax_rho</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$σ_0$ [kg/m$^3$]&quot;</span><span class="p">)</span>
<span class="n">ax_rho</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax_z</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">aber</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">K_OC_LAT</span><span class="p">,</span>
        <span class="n">aber</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">K_OC_PSI</span><span class="p">,</span>
        <span class="n">aber</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">K_OC_SST</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;ro&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;χpod estimate&quot;</span><span class="p">,</span> <span class="s2">&quot;Cole et al. (2015)&quot;</span><span class="p">,</span> <span class="s2">&quot;Abernathey &amp; Marshall (2013)&quot;</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">dcpy</span><span class="o">.</span><span class="n">oceans</span><span class="o">.</span><span class="n">TSplot</span><span class="p">(</span>
    <span class="n">p06</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">p06</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rho_levels</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hexbin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_distrib</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">p06</span><span class="o">.</span><span class="n">transect_name</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># plt.savefig(&quot;../images/p06-Ke.png&quot;, bbox_inches=&quot;tight&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/work/python/xarray/xarray/core/nanops.py:142: RuntimeWarning: Mean of empty slice
  return np.nanmean(a, axis=axis, dtype=dtype)
</pre></div>
</div>
<img alt="_images/P06-proposal_22_1.png" src="_images/P06-proposal_22_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">240</span><span class="p">))</span> <span class="c1">#.coarsen(cast=5).mean().plot(x=&quot;cast&quot;, norm=mpl.colors.LogNorm(0.1, 5e3), robust=True)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
&lt;ipython-input-259-9f6bb7b7d953&gt; in &lt;module&gt;
----&gt; 1 newKe.Ke.where(newKe.Ke &gt; 0).isel(cast=slice(240)) #.coarsen(cast=5).mean().plot(x=&quot;cast&quot;, norm=mpl.colors.LogNorm(0.1, 5e3), robust=True)

~/work/python/xarray/xarray/core/dataarray.py in isel(self, indexers, drop, missing_dims, **indexers_kwargs)
   1051         # lists, or zero or one-dimensional np.ndarray&#39;s
   1052 
-&gt; 1053         variable = self._variable.isel(indexers, missing_dims=missing_dims)
   1054 
   1055         coords = {}

~/work/python/xarray/xarray/core/variable.py in isel(self, indexers, missing_dims, **indexers_kwargs)
   1062 
   1063         key = tuple(indexers.get(dim, slice(None)) for dim in self.dims)
-&gt; 1064         return self[key]
   1065 
   1066     def squeeze(self, dim=None):

~/work/python/xarray/xarray/core/variable.py in __getitem__(self, key)
    702         array `x.values` directly.
    703         &quot;&quot;&quot;
--&gt; 704         dims, indexer, new_order = self._broadcast_indexes(key)
    705         data = as_indexable(self._data)[indexer]
    706         if new_order:

~/work/python/xarray/xarray/core/variable.py in _broadcast_indexes(self, key)
    541 
    542         if all(isinstance(k, BASIC_INDEXING_TYPES) for k in key):
--&gt; 543             return self._broadcast_indexes_basic(key)
    544 
    545         self._validate_indexers(key)

~/work/python/xarray/xarray/core/variable.py in _broadcast_indexes_basic(self, key)
    569             dim for k, dim in zip(key, self.dims) if not isinstance(k, integer_types)
    570         )
--&gt; 571         return dims, BasicIndexer(key), None
    572 
    573     def _validate_indexers(self, key):

~/work/python/xarray/xarray/core/indexing.py in __init__(self, key)
    376             new_key.append(k)
    377 
--&gt; 378         super().__init__(new_key)
    379 
    380 

~/work/python/xarray/xarray/core/indexing.py in __init__(self, key)
    329         if type(self) is ExplicitIndexer:
    330             raise TypeError(&quot;cannot instantiate base ExplicitIndexer objects&quot;)
--&gt; 331         self._key = tuple(key)
    332 
    333     @property

TypeError: descriptor &#39;_key&#39; for &#39;ExplicitIndexer&#39; objects doesn&#39;t apply to &#39;BasicIndexer&#39; object
</pre></div>
</div>
</div>
</div>
<p>Linear fits to ECCO T along ρ surfaces in the along-transect direction doesn’t work. The field has too much curvature</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># recalculate gradients from mean fields in density space</span>
<span class="n">dTiso</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">dTiso</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;dTiso&quot;</span>
<span class="n">dTdz</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">dTdz</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;dTdz&quot;</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">rho</span><span class="p">):</span>
    <span class="n">Tvec</span> <span class="o">=</span> <span class="n">eccodens</span><span class="o">.</span><span class="n">Tmean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">rr</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Tvec</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Tvec</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span>
            <span class="n">eccodens</span><span class="o">.</span><span class="n">dist</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">Tvec</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">dTiso</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">slope</span>

<span class="n">dTdz</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">Tmean</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">),</span> <span class="n">eccodens</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">))</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dTiso</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dTiso</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s2">&quot;recalculated from density-averaged field&quot;</span><span class="p">,</span>
        <span class="s2">&quot;along-transect mean of local gradient&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">dTdz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">eccodens</span><span class="o">.</span><span class="n">dTdz</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f1727a84630&gt;]
</pre></div>
</div>
<img alt="_images/P06-proposal_25_1.png" src="_images/P06-proposal_25_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nn</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">Tvec</span> <span class="o">=</span> <span class="n">eccodens</span><span class="o">.</span><span class="n">Tmean</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">nn</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Tvec</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dist</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">Tvec</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">Tvec</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">dTiso</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">nn</span><span class="p">)</span> <span class="o">*</span>  <span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dist</span><span class="o">-</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f1725c2a6d8&gt;]
</pre></div>
</div>
<img alt="_images/P06-proposal_26_1.png" src="_images/P06-proposal_26_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">argograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fd75806b350&gt;
</pre></div>
</div>
<img alt="_images/P06-proposal_27_1.png" src="_images/P06-proposal_27_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eccograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fd75a8a8510&gt;
</pre></div>
</div>
<img alt="_images/P06-proposal_28_1.png" src="_images/P06-proposal_28_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clim</span> <span class="o">=</span> <span class="n">eccograd</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">clim</span> <span class="o">=</span> <span class="n">clim</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">trmean</span><span class="p">,</span> <span class="n">ρbins</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">average_transect_1d</span><span class="p">(</span><span class="n">p06</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    
<span class="n">climrho</span> <span class="o">=</span> <span class="n">clim</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">clim</span><span class="o">.</span><span class="n">ρmean</span><span class="p">,</span> <span class="n">ρbins</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cole</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">55</span><span class="o">-</span><span class="mi">05</span><span class="n">ef08ea103d</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">cole</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;mpl&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cole</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;cast&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f1730d097b8&gt;]
</pre></div>
</div>
<img alt="_images/P06-proposal_31_1.png" src="_images/P06-proposal_31_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clim</span> <span class="o">=</span> <span class="n">eccograd</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">transect</span> <span class="o">=</span> <span class="n">p06</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">))</span>

<span class="n">trmean</span><span class="p">,</span> <span class="n">ρbins</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">average_transect_1d</span><span class="p">(</span><span class="n">transect</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">gradmean</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">average_clim</span><span class="p">(</span><span class="n">clim</span><span class="p">,</span> <span class="n">transect</span><span class="p">,</span> <span class="n">ρbins</span><span class="p">)</span>

<span class="n">Ke</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">estimate_Ke</span><span class="p">(</span><span class="n">trmean</span><span class="p">,</span> <span class="n">gradmean</span><span class="p">)</span>
<span class="n">Ke</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi</th>
      <th>KtTz</th>
      <th>dTdz</th>
      <th>dTmdz</th>
      <th>dTiso</th>
      <th>KT</th>
      <th>Ke</th>
    </tr>
    <tr>
      <th>rho</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(1024.8000000000002, 1026.7]</th>
      <td>1.340903e-07</td>
      <td>1.843108e-06</td>
      <td>0.021105</td>
      <td>0.021170</td>
      <td>4.694987e-06</td>
      <td>0.000118</td>
      <td>1271.439129</td>
    </tr>
    <tr>
      <th>(1026.7, 1027.5]</th>
      <td>8.350073e-08</td>
      <td>1.431120e-06</td>
      <td>0.026548</td>
      <td>0.023706</td>
      <td>3.095114e-06</td>
      <td>0.000058</td>
      <td>816.732447</td>
    </tr>
    <tr>
      <th>(1027.5, 1028.2]</th>
      <td>6.809042e-08</td>
      <td>1.229691e-06</td>
      <td>0.024866</td>
      <td>0.026552</td>
      <td>2.792055e-06</td>
      <td>0.000053</td>
      <td>178.802085</td>
    </tr>
    <tr>
      <th>(1028.2, 1028.9]</th>
      <td>3.888472e-08</td>
      <td>9.499299e-07</td>
      <td>0.018603</td>
      <td>0.019622</td>
      <td>1.978210e-06</td>
      <td>0.000053</td>
      <td>205.196687</td>
    </tr>
    <tr>
      <th>(1028.9, 1029.4]</th>
      <td>1.696346e-08</td>
      <td>6.028373e-07</td>
      <td>0.011949</td>
      <td>0.011681</td>
      <td>1.093078e-06</td>
      <td>0.000053</td>
      <td>1205.030222</td>
    </tr>
    <tr>
      <th>(1029.4, 1029.9]</th>
      <td>1.025537e-08</td>
      <td>4.112075e-07</td>
      <td>0.008578</td>
      <td>0.009867</td>
      <td>4.934073e-07</td>
      <td>0.000047</td>
      <td>4396.180518</td>
    </tr>
    <tr>
      <th>(1029.9, 1030.4]</th>
      <td>6.098227e-09</td>
      <td>3.541930e-07</td>
      <td>0.006906</td>
      <td>0.006893</td>
      <td>3.572366e-07</td>
      <td>0.000053</td>
      <td>4761.760099</td>
    </tr>
    <tr>
      <th>(1030.4, 1030.9]</th>
      <td>5.922741e-09</td>
      <td>3.396340e-07</td>
      <td>0.006503</td>
      <td>0.005814</td>
      <td>3.952476e-07</td>
      <td>0.000051</td>
      <td>6315.357062</td>
    </tr>
    <tr>
      <th>(1030.9, 1031.4]</th>
      <td>4.479737e-09</td>
      <td>3.283833e-07</td>
      <td>0.006106</td>
      <td>0.005641</td>
      <td>3.961862e-07</td>
      <td>0.000056</td>
      <td>2468.021433</td>
    </tr>
    <tr>
      <th>(1031.4, 1031.9]</th>
      <td>4.335862e-09</td>
      <td>3.358884e-07</td>
      <td>0.005741</td>
      <td>0.005445</td>
      <td>3.654930e-07</td>
      <td>0.000059</td>
      <td>2536.931307</td>
    </tr>
    <tr>
      <th>(1031.9, 1032.4]</th>
      <td>3.778694e-09</td>
      <td>3.191589e-07</td>
      <td>0.005229</td>
      <td>0.006691</td>
      <td>3.008868e-07</td>
      <td>0.000064</td>
      <td>-2719.446279</td>
    </tr>
    <tr>
      <th>(1032.4, 1032.9]</th>
      <td>2.663402e-09</td>
      <td>2.663522e-07</td>
      <td>0.004435</td>
      <td>0.005343</td>
      <td>2.868961e-07</td>
      <td>0.000064</td>
      <td>-1111.907562</td>
    </tr>
    <tr>
      <th>(1032.9, 1033.4]</th>
      <td>2.050237e-09</td>
      <td>2.458359e-07</td>
      <td>0.003670</td>
      <td>0.002568</td>
      <td>1.781828e-07</td>
      <td>0.000071</td>
      <td>12403.643288</td>
    </tr>
    <tr>
      <th>(1033.4, 1033.9]</th>
      <td>1.563165e-09</td>
      <td>2.117540e-07</td>
      <td>0.003097</td>
      <td>0.003163</td>
      <td>1.434013e-07</td>
      <td>0.000068</td>
      <td>5439.135721</td>
    </tr>
    <tr>
      <th>(1033.9, 1034.4]</th>
      <td>1.084065e-09</td>
      <td>1.862677e-07</td>
      <td>0.002532</td>
      <td>0.002644</td>
      <td>1.283914e-07</td>
      <td>0.000076</td>
      <td>3006.651780</td>
    </tr>
    <tr>
      <th>(1034.4, 1034.9]</th>
      <td>8.051773e-10</td>
      <td>1.646219e-07</td>
      <td>0.002085</td>
      <td>0.002116</td>
      <td>1.193445e-07</td>
      <td>0.000082</td>
      <td>3804.070508</td>
    </tr>
    <tr>
      <th>(1034.9, 1035.4]</th>
      <td>5.643653e-10</td>
      <td>1.386612e-07</td>
      <td>0.001779</td>
      <td>0.001680</td>
      <td>1.091446e-07</td>
      <td>0.000080</td>
      <td>4130.684457</td>
    </tr>
    <tr>
      <th>(1035.4, 1035.9]</th>
      <td>3.849335e-10</td>
      <td>1.173186e-07</td>
      <td>0.001456</td>
      <td>NaN</td>
      <td>1.000824e-07</td>
      <td>0.000083</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>(1035.9, 1036.4]</th>
      <td>2.681242e-10</td>
      <td>1.045344e-07</td>
      <td>0.001217</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000090</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>(1036.4, 1036.9]</th>
      <td>2.172361e-10</td>
      <td>9.460649e-08</td>
      <td>0.001071</td>
      <td>NaN</td>
      <td>8.956461e-08</td>
      <td>0.000094</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compare_transect_clim</span><span class="p">(</span><span class="n">transect</span><span class="p">,</span> <span class="n">clim</span><span class="p">):</span>

    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="p">(</span><span class="n">trvar</span><span class="p">,</span> <span class="n">climvar</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Tmean&quot;</span><span class="p">,</span> <span class="s2">&quot;Smean&quot;</span><span class="p">,</span> <span class="s2">&quot;ρmean&quot;</span><span class="p">])</span>
    <span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">transect</span><span class="p">[</span><span class="n">trvar</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">20</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="n">clim</span><span class="p">[</span><span class="n">climvar</span><span class="p">]</span>
            <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">ed</span><span class="o">.</span><span class="n">get_region_from_transect</span><span class="p">(</span><span class="n">p06</span><span class="p">))</span>
            <span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span>
                <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span>
            <span class="n">transect</span><span class="p">[</span><span class="n">trvar</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">trname</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">transect</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;transect_name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;transect_name&quot;</span> <span class="ow">in</span> <span class="n">transect</span><span class="o">.</span><span class="n">attrs</span>
        <span class="k">else</span> <span class="s2">&quot;transect&quot;</span>
    <span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Compare &quot;</span> <span class="o">+</span> <span class="n">trname</span> <span class="o">+</span> <span class="s2">&quot; vs &quot;</span> <span class="o">+</span> <span class="n">clim</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>


<span class="n">compare_transect_clim</span><span class="p">(</span><span class="n">p06</span><span class="p">,</span> <span class="n">eccograd</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="c1">#  compare_transect_clim(p06, argograd)</span>
<span class="c1"># plt.gca().set_ylim((2400, 0))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-19-6a0f5cf774f5&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> 
<span class="g g-Whitespace">     </span><span class="mi">22</span> 
<span class="ne">---&gt; </span><span class="mi">23</span> <span class="n">compare_transect_clim</span><span class="p">(</span><span class="n">p06</span><span class="p">,</span> <span class="n">eccograd</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="c1">#  compare_transect_clim(p06, argograd)</span>

<span class="nn">~/work/python/xarray/xarray/core/dataset.py</span> in <span class="ni">sel</span><span class="nt">(self, indexers, method, tolerance, drop, **indexers_kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1507</span>         <span class="n">indexers</span> <span class="o">=</span> <span class="n">either_dict_or_kwargs</span><span class="p">(</span><span class="n">indexers</span><span class="p">,</span> <span class="n">indexers_kwargs</span><span class="p">,</span> <span class="s1">&#39;sel&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1508</span>         <span class="n">pos_indexers</span><span class="p">,</span> <span class="n">new_indexes</span> <span class="o">=</span> <span class="n">remap_label_indexers</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1509</span>             <span class="bp">self</span><span class="p">,</span> <span class="n">indexers</span><span class="o">=</span><span class="n">indexers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1510</span>         <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">indexers</span><span class="o">=</span><span class="n">pos_indexers</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1511</span>         <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">_replace_indexes</span><span class="p">(</span><span class="n">new_indexes</span><span class="p">)</span>

<span class="nn">~/work/python/xarray/xarray/core/coordinates.py</span> in <span class="ni">remap_label_indexers</span><span class="nt">(obj, indexers, method, tolerance, **indexers_kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span> 
<span class="g g-Whitespace">    </span><span class="mi">354</span>     <span class="n">pos_indexers</span><span class="p">,</span> <span class="n">new_indexes</span> <span class="o">=</span> <span class="n">indexing</span><span class="o">.</span><span class="n">remap_label_indexers</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">355</span>         <span class="n">obj</span><span class="p">,</span> <span class="n">v_indexers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span>     <span class="c1"># attach indexer&#39;s coordinate to pos_indexers</span>

<span class="nn">~/work/python/xarray/xarray/core/indexing.py</span> in <span class="ni">remap_label_indexers</span><span class="nt">(data_obj, indexers, method, tolerance)</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span>     <span class="n">new_indexes</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">    </span><span class="mi">236</span> 
<span class="ne">--&gt; </span><span class="mi">237</span>     <span class="n">dim_indexers</span> <span class="o">=</span> <span class="n">get_dim_indexers</span><span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="n">indexers</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">238</span>     <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dim_indexers</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">239</span>         <span class="k">try</span><span class="p">:</span>

<span class="nn">~/work/python/xarray/xarray/core/indexing.py</span> in <span class="ni">get_dim_indexers</span><span class="nt">(data_obj, indexers)</span>
<span class="g g-Whitespace">    </span><span class="mi">203</span>     <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">204</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dimensions or multi-index levels </span><span class="si">%r</span><span class="s2"> do not exist&quot;</span>
<span class="ne">--&gt; </span><span class="mi">205</span>                          <span class="o">%</span> <span class="n">invalid</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span> 
<span class="g g-Whitespace">    </span><span class="mi">207</span>     <span class="n">level_indexers</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

<span class="ne">ValueError</span>: dimensions or multi-index levels [&#39;time&#39;] do not exist
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</div>
<hr class="docutils" />
<div class="section" id="calculate-3">
<h2>Calculate 3<a class="headerlink" href="#calculate-3" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">aimport</span> eddydiff
<span class="kn">import</span> <span class="nn">eddydiff</span> <span class="k">as</span> <span class="nn">ed</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">eddydiff</span><span class="o">.</span><span class="n">format_ecco2</span><span class="p">(</span><span class="n">kecco</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:     (lat: 360, lon: 720, pres: 50)
Coordinates:
  * lat         (lat) float64 -89.75 -89.25 -88.75 -88.25 ... 88.75 89.25 89.75
  * lon         (lon) float64 -179.8 -179.2 -178.8 -178.2 ... 178.8 179.2 179.8
  * pres        (pres) float64 1.0 2.0 3.0 4.0 5.0 ... 46.0 47.0 48.0 49.0 50.0
Data variables:
    Kgm_ECCOv4  (lat, lon, pres) float32 nan nan nan nan nan ... nan nan nan nan
Attributes:
    title:          Bolus Velocity Coefficient (ECCO v4 Estimate; Forget et a...
    Format:         native grid (nctiles w. 52 tiles)
    source:         ECCO consortium (http://ecco-group.org/)
    institution:    MIT
    history:         files revision history :\n    2016/05/07 : release of re...
    references:     Forget, G., J.-M. Campin, P. Heimbach, C. N. Hill, R. M. ...
    _FillValue:     nan
    missing_value:  nan
    Conventions:    CF-1.6
    date:           10-May-2016</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-832be6d1-7e29-4baf-a385-85fbec711dfd' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-832be6d1-7e29-4baf-a385-85fbec711dfd' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 360</li><li><span class='xr-has-index'>lon</span>: 720</li><li><span class='xr-has-index'>pres</span>: 50</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-0d01488f-aa84-463b-b755-2bcc0dfb919a' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0d01488f-aa84-463b-b755-2bcc0dfb919a' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-89.75 -89.25 ... 89.25 89.75</div><input id='attrs-a5ca09ee-026f-44c0-998a-bf90dd0ba9a1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a5ca09ee-026f-44c0-998a-bf90dd0ba9a1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-db9532ee-4bc2-4b8c-917f-595f2ae11c9a' class='xr-var-data-in' type='checkbox'><label for='data-db9532ee-4bc2-4b8c-917f-595f2ae11c9a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([-89.75, -89.25, -88.75, ...,  88.75,  89.25,  89.75])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-179.8 -179.2 ... 179.2 179.8</div><input id='attrs-62dd4c73-9e63-45f7-8dbf-3c743f1f3c16' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-62dd4c73-9e63-45f7-8dbf-3c743f1f3c16' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-616f86ae-7612-4580-b90f-278a58ba3c41' class='xr-var-data-in' type='checkbox'><label for='data-616f86ae-7612-4580-b90f-278a58ba3c41' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([-179.75, -179.25, -178.75, ...,  178.75,  179.25,  179.75])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>pres</span></div><div class='xr-var-dims'>(pres)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.0 2.0 3.0 4.0 ... 48.0 49.0 50.0</div><input id='attrs-06c8f4a8-61fa-4123-8d12-6538964d9655' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-06c8f4a8-61fa-4123-8d12-6538964d9655' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-427b275a-4749-4c14-accd-1e69607ad3e5' class='xr-var-data-in' type='checkbox'><label for='data-427b275a-4749-4c14-accd-1e69607ad3e5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>array index 3</dd><dt><span>units :</span></dt><dd>1</dd></dl></div><pre class='xr-var-data'>array([ 1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9., 10., 11., 12., 13., 14.,
       15., 16., 17., 18., 19., 20., 21., 22., 23., 24., 25., 26., 27., 28.,
       29., 30., 31., 32., 33., 34., 35., 36., 37., 38., 39., 40., 41., 42.,
       43., 44., 45., 46., 47., 48., 49., 50.])</pre></li></ul></div></li><li class='xr-section-item'><input id='section-29eb1295-abbb-4b76-b2db-ae522be37e1a' class='xr-section-summary-in' type='checkbox'  checked><label for='section-29eb1295-abbb-4b76-b2db-ae522be37e1a' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>Kgm_ECCOv4</span></div><div class='xr-var-dims'>(lat, lon, pres)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-5abb898e-b64a-4904-9cc7-fedeca0365cd' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5abb898e-b64a-4904-9cc7-fedeca0365cd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e306ea6d-46cd-416b-8ca1-42e99c3b4159' class='xr-var-data-in' type='checkbox'><label for='data-e306ea6d-46cd-416b-8ca1-42e99c3b4159' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Bolus Velocity Coefficient (ECCO v4 Estimate; Forget et al 2015a,b,2016)</dd><dt><span>units :</span></dt><dd>m^2/s</dd></dl></div><pre class='xr-var-data'>array([[[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       ...,

       [[659.4894 , 500.91663, 320.21997, ...,       nan,       nan,
               nan],
        [660.7585 , 502.7165 , 322.60538, ...,       nan,       nan,
               nan],
        [662.02216, 504.51074, 324.98486, ...,       nan,       nan,
               nan],
        ...,
        [655.61163, 495.4347 , 312.96793, ...,       nan,       nan,
               nan],
        [656.9137 , 497.27267, 315.39694, ...,       nan,       nan,
               nan],
        [658.20605, 499.1001 , 317.81445, ...,       nan,       nan,
               nan]],

       [[603.9421 , 434.1819 , 238.91277, ...,       nan,       nan,
               nan],
        [604.6996 , 435.15845, 240.00772, ...,       nan,       nan,
               nan],
        [605.4477 , 436.12415, 241.09155, ...,       nan,       nan,
               nan],
        ...,
        [601.6406 , 431.22247, 235.60126, ...,       nan,       nan,
               nan],
        [602.41565, 432.2176 , 236.71368, ...,       nan,       nan,
               nan],
        [603.1812 , 433.20172, 237.8149 , ...,       nan,       nan,
               nan]],

       [[554.81036, 379.41898, 189.04736, ...,       nan,       nan,
               nan],
        [555.0568 , 379.70895, 189.2995 , ...,       nan,       nan,
               nan],
        [555.29944, 379.99478, 189.54868, ...,       nan,       nan,
               nan],
        ...,
        [554.06714, 378.54477, 188.28748, ...,       nan,       nan,
               nan],
        [554.31366, 378.83453, 188.53893, ...,       nan,       nan,
               nan],
        [554.5586 , 379.1227 , 188.78952, ...,       nan,       nan,
               nan]]], dtype=float32)</pre></li></ul></div></li><li class='xr-section-item'><input id='section-f5d3fe45-ad7a-42c8-85a5-39c7e38f5032' class='xr-section-summary-in' type='checkbox'  ><label for='section-f5d3fe45-ad7a-42c8-85a5-39c7e38f5032' class='xr-section-summary' >Attributes: <span>(10)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>title :</span></dt><dd>Bolus Velocity Coefficient (ECCO v4 Estimate; Forget et al 2015a,b,2016) -- ECCO v4 ocean state estimate, release 2 -- 1992-2011</dd><dt><span>Format :</span></dt><dd>native grid (nctiles w. 52 tiles)</dd><dt><span>source :</span></dt><dd>ECCO consortium (http://ecco-group.org/)</dd><dt><span>institution :</span></dt><dd>MIT</dd><dt><span>history :</span></dt><dd> files revision history :
    2016/05/07 : release of remote sensed variables (GF)
    2015/12/12 : second release of ECCO v4 (GF)
    2014/02/04 : initial release of ECCO v4 (GF)
 estimate revision history :
    r4it12   : include geothermal heating, targeted bottom
      viscosity, and 2000-2011 wind stress adjustments that
      were omitted in r4it11; adjust global mean precipitation
      to closely match aviso global mean time series; put
      adjusted forcing fields on llc90 grid.
    r4it11   : reduce background vertical viscosity
    r4it10   : cleanup control vector adjustments
    r4it9    : optim. global mean sea level alone
    r4it0-8  : full adjoint iterations, omitting
      global mean sea level altimetry constraint.</dd><dt><span>references :</span></dt><dd>Forget, G., J.-M. Campin, P. Heimbach, C. N. Hill, R. M. Ponte, 
 and C. Wunsch, 2015: ECCO version 4: an integrated framework for 
 non-linear inverse modeling and global ocean state estimation. 
 Geoscientific Model Development, 8, 3071-3104, doi:10.5194/gmd-8-3071-2015 
Forget, G., D. Ferreira, and X. Liang, 2015: On the observability of turbulent 
 transport rates by argo: supporting evidence from an inversion experiment. 
 Ocean Science, 11, 839853, doi:10.5194/os-11-839-2015 
Forget, G., J.-M. Campin, P. Heimbach, C. N. Hill, R. M. Ponte, and C. Wunsch, 2016: 
 ECCO version 4: Second Release, http://hdl.handle.net/1721.1/102062</dd><dt><span>_FillValue :</span></dt><dd>nan</dd><dt><span>missing_value :</span></dt><dd>nan</dd><dt><span>Conventions :</span></dt><dd>CF-1.6</dd><dt><span>date :</span></dt><dd>10-May-2016</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kecco</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s2">&quot;../datasets/ecco/interp_Kgm_ECCOv4.nc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">ed</span><span class="o">.</span><span class="n">eddydiff</span><span class="o">.</span><span class="n">format_ecco2</span><span class="p">)</span><span class="o">.</span><span class="n">Kgm_ECCOv4</span>
<span class="n">kecco</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;Kgm_ECCOv4&#x27; (lat: 360, lon: 720, pres: 50)&gt;
array([[[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       ...,

       [[449.7568 , 269.2915 , 146.21722, ...,       nan,       nan,
               nan],
        [449.26746, 269.019  , 146.27124, ...,       nan,       nan,
               nan],
        [448.78452, 268.7531 , 146.32971, ...,       nan,       nan,
               nan],
        ...,
        [451.28967, 270.1708 , 146.09207, ...,       nan,       nan,
               nan],
        [450.76907, 269.86832, 146.12814, ...,       nan,       nan,
               nan],
        [450.25885, 269.57617, 146.1708 , ...,       nan,       nan,
               nan]],

       [[488.71448, 306.11115, 164.50214, ...,       nan,       nan,
               nan],
        [488.2017 , 305.6677 , 164.3479 , ...,       nan,       nan,
               nan],
        [487.69604, 305.23145, 164.19669, ...,       nan,       nan,
               nan],
        ...,
        [490.2769 , 307.46857, 164.97755, ...,       nan,       nan,
               nan],
        [489.7501 , 307.00974, 164.81644, ...,       nan,       nan,
               nan],
        [489.23047, 306.55817, 164.65837, ...,       nan,       nan,
               nan]],

       [[521.16046, 340.92065, 172.53606, ...,       nan,       nan,
               nan],
        [520.9415 , 340.68723, 172.3936 , ...,       nan,       nan,
               nan],
        [520.72534, 340.4571 , 172.25227, ...,       nan,       nan,
               nan],
        ...,
        [521.8189 , 341.62262, 172.96187, ...,       nan,       nan,
               nan],
        [521.60065, 341.38974, 172.82086, ...,       nan,       nan,
               nan],
        [521.38165, 341.15634, 172.6784 , ...,       nan,       nan,
               nan]]], dtype=float32)
Coordinates:
  * lat      (lat) float64 -89.75 -89.25 -88.75 -88.25 ... 88.75 89.25 89.75
  * lon      (lon) float64 0.25 0.75 1.25 1.75 2.25 ... 358.2 358.8 359.2 359.8
  * pres     (pres) float64 5.0 15.0 25.0 35.0 ... 5.039e+03 5.461e+03 5.906e+03
Attributes:
    long_name:  Bolus Velocity Coefficient (ECCO v4 Estimate; Forget et al 20...
    units:      m^2/s</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'Kgm_ECCOv4'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 360</li><li><span class='xr-has-index'>lon</span>: 720</li><li><span class='xr-has-index'>pres</span>: 50</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-c64799bc-6d36-4f8b-abca-91ac55222694' class='xr-array-in' type='checkbox' ><label for='section-c64799bc-6d36-4f8b-abca-91ac55222694' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>nan nan nan nan nan nan nan ... 967.74115 972.6106 nan nan nan nan</span></div><pre class='xr-array-data'>array([[[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       [[      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        ...,
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan],
        [      nan,       nan,       nan, ...,       nan,       nan,
               nan]],

       ...,

       [[449.7568 , 269.2915 , 146.21722, ...,       nan,       nan,
               nan],
        [449.26746, 269.019  , 146.27124, ...,       nan,       nan,
               nan],
        [448.78452, 268.7531 , 146.32971, ...,       nan,       nan,
               nan],
        ...,
        [451.28967, 270.1708 , 146.09207, ...,       nan,       nan,
               nan],
        [450.76907, 269.86832, 146.12814, ...,       nan,       nan,
               nan],
        [450.25885, 269.57617, 146.1708 , ...,       nan,       nan,
               nan]],

       [[488.71448, 306.11115, 164.50214, ...,       nan,       nan,
               nan],
        [488.2017 , 305.6677 , 164.3479 , ...,       nan,       nan,
               nan],
        [487.69604, 305.23145, 164.19669, ...,       nan,       nan,
               nan],
        ...,
        [490.2769 , 307.46857, 164.97755, ...,       nan,       nan,
               nan],
        [489.7501 , 307.00974, 164.81644, ...,       nan,       nan,
               nan],
        [489.23047, 306.55817, 164.65837, ...,       nan,       nan,
               nan]],

       [[521.16046, 340.92065, 172.53606, ...,       nan,       nan,
               nan],
        [520.9415 , 340.68723, 172.3936 , ...,       nan,       nan,
               nan],
        [520.72534, 340.4571 , 172.25227, ...,       nan,       nan,
               nan],
        ...,
        [521.8189 , 341.62262, 172.96187, ...,       nan,       nan,
               nan],
        [521.60065, 341.38974, 172.82086, ...,       nan,       nan,
               nan],
        [521.38165, 341.15634, 172.6784 , ...,       nan,       nan,
               nan]]], dtype=float32)</pre></div></li><li class='xr-section-item'><input id='section-d0cc3555-b03f-4f5a-8664-71d6109d0d5b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d0cc3555-b03f-4f5a-8664-71d6109d0d5b' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-89.75 -89.25 ... 89.25 89.75</div><input id='attrs-c75a29c6-cb54-49d2-adf0-89eb54489151' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c75a29c6-cb54-49d2-adf0-89eb54489151' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2bfcb924-8056-440f-9f9e-b3f5e3121592' class='xr-var-data-in' type='checkbox'><label for='data-2bfcb924-8056-440f-9f9e-b3f5e3121592' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([-89.75, -89.25, -88.75, ...,  88.75,  89.25,  89.75])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.25 0.75 1.25 ... 359.2 359.8</div><input id='attrs-5971773a-0e8e-4e72-9ce9-3d8de2d772aa' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5971773a-0e8e-4e72-9ce9-3d8de2d772aa' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d6ba22ff-6269-4f73-8fac-2283a2604169' class='xr-var-data-in' type='checkbox'><label for='data-d6ba22ff-6269-4f73-8fac-2283a2604169' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([2.5000e-01, 7.5000e-01, 1.2500e+00, ..., 3.5875e+02, 3.5925e+02,
       3.5975e+02])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>pres</span></div><div class='xr-var-dims'>(pres)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>5.0 15.0 ... 5.461e+03 5.906e+03</div><input id='attrs-161fbdbf-fbcc-4020-b351-9078083fca54' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-161fbdbf-fbcc-4020-b351-9078083fca54' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d3e67692-3069-40ee-9ec9-bc75d1b4a878' class='xr-var-data-in' type='checkbox'><label for='data-d3e67692-3069-40ee-9ec9-bc75d1b4a878' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([5.000000e+00, 1.500000e+01, 2.500000e+01, 3.500000e+01, 4.500000e+01,
       5.500000e+01, 6.500000e+01, 7.500500e+01, 8.502500e+01, 9.509500e+01,
       1.053100e+02, 1.158700e+02, 1.271500e+02, 1.397400e+02, 1.544700e+02,
       1.724000e+02, 1.947350e+02, 2.227100e+02, 2.574700e+02, 2.999300e+02,
       3.506800e+02, 4.099300e+02, 4.774700e+02, 5.527100e+02, 6.347350e+02,
       7.224000e+02, 8.144700e+02, 9.097400e+02, 1.007155e+03, 1.105905e+03,
       1.205535e+03, 1.306205e+03, 1.409150e+03, 1.517095e+03, 1.634175e+03,
       1.765135e+03, 1.914150e+03, 2.084035e+03, 2.276225e+03, 2.491250e+03,
       2.729250e+03, 2.990250e+03, 3.274250e+03, 3.581250e+03, 3.911250e+03,
       4.264250e+03, 4.640250e+03, 5.039250e+03, 5.461250e+03, 5.906250e+03])</pre></li></ul></div></li><li class='xr-section-item'><input id='section-dfa36cf7-4775-4e82-b545-0ca7d7449a85' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dfa36cf7-4775-4e82-b545-0ca7d7449a85' class='xr-section-summary' >Attributes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Bolus Velocity Coefficient (ECCO v4 Estimate; Forget et al 2015a,b,2016)</dd><dt><span>units :</span></dt><dd>m^2/s</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kecco</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">p06</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">p06</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">pres</span><span class="o">=</span><span class="n">p06</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fd6c9b508d0&gt;]
</pre></div>
</div>
<img alt="_images/P06-proposal_38_1.png" src="_images/P06-proposal_38_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kecco</span><span class="o">.</span><span class="n">interp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fd6d66d1dd0&gt;
</pre></div>
</div>
<img alt="_images/P06-proposal_39_1.png" src="_images/P06-proposal_39_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newKe</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;KT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">KT</span> <span class="c1">#.mean(dim=&quot;cast&quot;)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;chi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">chi</span><span class="c1"># .mean(dim=&quot;cast&quot;)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;KtTz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">KtTz</span><span class="c1">#.mean(dim=&quot;cast&quot;)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTiso&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dTiso</span><span class="p">)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTmdz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eccodens</span><span class="o">.</span><span class="n">dTdia</span><span class="p">)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTdz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">dTdz</span> <span class="c1">#.mean(dim=&quot;cast&quot;)</span>
<span class="n">newKe</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;pres&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trdens</span><span class="o">.</span><span class="n">pres</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span>
<span class="c1"># newKe = newKe.sel(cast=slice(242)).coarsen(cast=60).mean()</span>
<span class="c1"># newKe = newKe.mean(&quot;cast&quot;)</span>
<span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;Ke&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;chi&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;KtTz&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTmdz&quot;</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span>
    <span class="n">newKe</span><span class="p">[</span><span class="s2">&quot;dTiso&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="p">)</span>
<span class="c1"># ed.plot_bar_Ke(newKe.to_dataframe())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fullmean</span> <span class="o">=</span> <span class="n">newKe</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cole</span><span class="o">.</span><span class="n">diffusivity</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">242</span><span class="p">))</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">cast</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">hue</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/work/python/xarray/xarray/core/nanops.py:142: RuntimeWarning: Mean of empty slice
  return np.nanmean(a, axis=axis, dtype=dtype)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fd6d6915290&gt;,
 &lt;matplotlib.lines.Line2D at 0x7fd6d6915490&gt;,
 &lt;matplotlib.lines.Line2D at 0x7fd6d6915650&gt;,
 &lt;matplotlib.lines.Line2D at 0x7fd6d6915810&gt;,
 &lt;matplotlib.lines.Line2D at 0x7fd6d69159d0&gt;,
 &lt;matplotlib.lines.Line2D at 0x7fd6d6915b90&gt;]
</pre></div>
</div>
<img alt="_images/P06-proposal_42_2.png" src="_images/P06-proposal_42_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fullmean</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">hue</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;pres&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">newKe</span><span class="o">.</span><span class="n">Ke</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hue</span><span class="o">=</span><span class="s2">&quot;cast&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;pres&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eccograd</span><span class="p">,</span> <span class="n">argograd</span><span class="p">,</span> <span class="n">cole</span><span class="p">,</span> <span class="n">aber</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">read_all_datasets</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">norm</span><span class="p">):</span>
    <span class="n">hdl</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">280</span><span class="p">))</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">dcpy</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">liney</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">360</span><span class="o">-</span><span class="mi">140</span><span class="p">,</span> <span class="mi">360</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span> <span class="mi">360</span><span class="o">-</span><span class="mi">125</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hdl</span>


<span class="n">plot</span><span class="p">(</span>
    <span class="n">eccograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="mf">5e-7</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span>
    <span class="n">argograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="mf">5e-7</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">plot</span><span class="p">(</span>
    <span class="n">eccograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="mf">5e-8</span><span class="p">,</span> <span class="mf">5e-7</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span>
    <span class="n">argograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">),</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="mf">5e-8</span><span class="p">,</span> <span class="mf">5e-7</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

<span class="n">dcpy</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">label_subplots</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;../images/ecco-argo-grad-epac.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/dask/array/numpy_compat.py:40: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/dask/array/numpy_compat.py:40: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/dask/array/numpy_compat.py:40: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/dask/array/numpy_compat.py:40: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/matplotlib/colors.py:1171: RuntimeWarning: invalid value encountered in less_equal
  mask |= resdat &lt;= 0
</pre></div>
</div>
<img alt="_images/P06-proposal_45_1.png" src="_images/P06-proposal_45_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">argograd</span><span class="o">.</span><span class="n">dTiso</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">280</span><span class="p">))</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pres</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/deepak/miniconda3/envs/dcpy/lib/python3.7/site-packages/dask/array/numpy_compat.py:40: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f16aa8b2b10&gt;
</pre></div>
</div>
<img alt="_images/P06-proposal_46_2.png" src="_images/P06-proposal_46_2.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Deepak Cherian<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            <div>
<script data-goatcounter="https://count.cherian.net/count"
        async src="count.js"></script>
</div>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>